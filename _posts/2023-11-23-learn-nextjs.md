---
title: å­¦ä¹  Next.js
date: 2023-11-23 22:02:00 -0500
categories: [ç¿»è¯‘, Nextjs]
tags: [nextjs, web]
description: Next.js å®˜æ–¹æ•™ç¨‹ç¿»è¯‘ï¼Œ2023-11-21 ç‰ˆæœ¬çš„ï¼Œåç»­è‹¥ç½‘ç«™å†…å®¹æ›´æ–°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒ
media_subpath: /assets/img/learn-nextjs/
---

> å®˜æ–¹æ•™ç¨‹é“¾æ¥ï¼šhttps://nextjs.org/learn/dashboard-app
{: .prompt-info}

## å­¦ä¹  Next.js

æ¬¢è¿æ¥åˆ° Next.js åº”ç”¨è·¯ç”±æ•™ç¨‹ï¼åœ¨è¿™ä¸ªå…è´¹çš„äº¤äº’å¼è¯¾ç¨‹ä¸­ï¼Œä½ å°†ä¼šé€šè¿‡æ„å»ºä¸€ä¸ªå…¨æ ˆç½‘é¡µåº”ç”¨æ¥å­¦ä¹  Next.js çš„ä¸»è¦åŠŸèƒ½ã€‚

> è¯‘æ³¨ï¼šå½“ç„¶æœ¬ç¿»è¯‘æ–‡ä»¶ä¸å¯èƒ½ä¸ºäº¤äº’å¼çš„å•¦~
{: .prompt-info}

### æˆ‘ä»¬è¦æ„å»ºä»€ä¹ˆ

![dashboard](dashboard.avif)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šæ„å»ºä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬çš„é‡‘èä»ªè¡¨ç›˜ï¼Œå¹¶æ‹¥æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š

- ä¸€ä¸ªå…¬å…±çš„ä¸»é¡µé¢
- ä¸€ä¸ªç™»å½•é¡µé¢
- å—èº«ä»½éªŒè¯ä¿æŠ¤çš„ä»ªè¡¨ç›˜é¡µé¢
- ç”¨æˆ·å¯ä»¥æ·»åŠ ã€ç¼–è¾‘å’Œåˆ é™¤å•æ®

è¿™ä¸ªä»ªè¡¨ç›˜ä¹Ÿä¼šé™„å¸¦ä¸€ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬ä¼šåœ¨[ä¹‹åçš„ç« èŠ‚](#ç¬¬å…­ç« -è®¾ç½®æ•°æ®åº“)ä¸­è®¾ç½®ã€‚

å­¦å®Œæœ¬æ•™ç¨‹åï¼Œä½ ä¼šåŸºæœ¬æŒæ¡å¼€å‘å…¨æ ˆ Next.js åº”ç”¨æ‰€éœ€çš„ä¸»è¦æŠ€èƒ½ã€‚

### æ¦‚è§ˆ

ä¸‹é¢æ˜¯æˆ‘ä»¬è¦åœ¨æœ¬æ•™ç¨‹ä¸­å­¦ä¹ çš„åŠŸèƒ½ï¼š

- **æ ·å¼**ï¼šåœ¨ Next.js ä¸­è®¾ç½®æ ·å¼çš„ä¸åŒæ–¹å¼ã€‚
- **ä¼˜åŒ–**ï¼šå¦‚ä½•ä¼˜åŒ–å›¾ç‰‡ã€é“¾æ¥å’Œå­—ä½“ã€‚
- **è·¯ç”±**ï¼šå¦‚ä½•ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯ç”±åˆ›å»ºåµŒå¥—çš„å¸ƒå±€å’Œé¡µé¢ã€‚
- **æ•°æ®æŠ“å–**ï¼šå¦‚ä½•åœ¨ Vercel ä¸Šè®¾ç½®æ•°æ®åº“ï¼Œå¦‚ä½•é«˜æ•ˆæŠ“å–å’Œæµå¼ä¼ è¾“ã€‚
- **æœç´¢å’Œåˆ†é¡µ**ï¼šå¦‚ä½•ä½¿ç”¨ URL æœç´¢å‚æ•°å®ç°æœç´¢å’Œåˆ†é¡µã€‚
- **æ›´æ”¹æ•°æ®**ï¼šå¦‚ä½•ä½¿ç”¨ React æœåŠ¡å™¨æ“ä½œæ›´æ”¹æ•°æ®ï¼Œä»¥åŠé‡æ–°éªŒè¯ Next.js ç¼“å­˜ã€‚
- **é”™è¯¯å¤„ç†**ï¼šå¦‚ä½•å¤„ç†ä¸€èˆ¬çš„å’Œ `404` é”™è¯¯ã€‚
- **è¡¨å•éªŒè¯å’Œè®¿é—®**ï¼šå¦‚ä½•åšæœåŠ¡å™¨ç«¯çš„è¡¨å•éªŒè¯ä»¥åŠæé«˜å¯è®¿é—®æ€§çš„æŠ€å·§ã€‚
- **èº«ä»½éªŒè¯**ï¼šå¦‚ä½•ä½¿ç”¨ [NextAuth.js](https://next-auth.js.org/) å’Œä¸­é—´ä»¶ä¸ºä½ çš„åº”ç”¨æ·»åŠ èº«ä»½éªŒè¯ã€‚
- **å…ƒæ•°æ®**ï¼šå¦‚ä½•æ·»åŠ å…ƒæ•°æ®ä»¥åŠä¸ºä½ çš„åº”ç”¨çš„ç¤¾äº¤åˆ†äº«åšå‡†å¤‡ã€‚

### é¢„å¤‡çŸ¥è¯†

æœ¬æ•™ç¨‹å‡è®¾ä½ å¯¹ React å’Œ JavaScript æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚å¦‚æœä½ ä¸äº†è§£ Reactï¼Œæˆ‘ä»¬æ¨èä½ å…ˆå­¦ä¹  [React åŸºç¡€]({{site.url}}/posts/react-foundations)ï¼Œäº†è§£ç»„ä»¶ã€å±æ€§ã€çŠ¶æ€ã€é’©å­ï¼Œä»¥åŠä¸€äº›æ–°åŠŸèƒ½ï¼Œæ¯”å¦‚æœåŠ¡å™¨ç»„ä»¶å’Œ Suspense ç»„ä»¶ã€‚

### ç³»ç»Ÿè¦æ±‚

åœ¨å¼€å§‹æœ¬æ•™ç¨‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿ä½ çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

- å®‰è£…äº† Node.js 18.17.0 æˆ–æ›´æ–°ç‰ˆæœ¬ã€‚[åœ¨è¿™é‡Œä¸‹è½½](https://nodejs.org/en)ã€‚
- æ“ä½œç³»ç»Ÿï¼šmacOSï¼ŒWindowsï¼ˆåŒ…æ‹¬ WSLï¼‰ï¼Œæˆ–è€… Linuxã€‚

å¦å¤–ï¼Œä½ è¿˜éœ€è¦æœ‰ä¸€ä¸ª [Github è´¦æˆ·](https://github.com/join/)å’Œ [Vercel è´¦æˆ·](https://vercel.com/signup)ã€‚

## ç¬¬ä¸€ç«  å¼€å§‹å‡†å¤‡

### åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®

æ‰“å¼€ç»ˆç«¯ï¼Œ[cd](https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Understanding_client-side_tools/Command_line#basic_built-in_terminal_commands) åˆ°ä½ æƒ³è¦ä¿å­˜é¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œç„¶åè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ¥åˆ›å»ºä¸€ä¸ª Next.js åº”ç”¨ï¼š

```shell
npx create-next-app@latest nextjs-dashboard --use-npm --example "https://github.com/vercel/next-learn/tree/main/dashboard/starter-example"
```
{: .nolineno}

è¯¥å‘½ä»¤ä½¿ç”¨äº† [`create-next-app`](https://nextjs.org/docs/app/api-reference/create-next-app)ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ æ­å»ºä¸€ä¸ª Next.js åº”ç”¨ã€‚åœ¨ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨äº† `--example` å‚æ•°ï¼Œæ„æ€æ˜¯æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨è¿™ä¸ª[åˆå­¦è€…æ¡ˆä¾‹](https://github.com/vercel/next-learn/tree/main/dashboard/starter-example)ã€‚

### æµè§ˆé¡¹ç›®

ä¸å…¶ä»–è¦ä»é›¶å†™ä»£ç çš„æ•™ç¨‹ä¸åŒï¼Œæœ¬æ•™ç¨‹çš„å¤§éƒ¨åˆ†ä»£ç æˆ‘ä»¬éƒ½ä¸ºä½ å‡†å¤‡å¥½äº†ã€‚è¿™ä¹Ÿè·Ÿå®é™…å¼€å‘æ—¶å·®ä¸å¤šï¼Œå¤§éƒ¨åˆ†æ—¶å€™ä½ éƒ½æ˜¯æ¥æ‰‹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„é¡¹ç›®å¹¶åœ¨ä¸Šé¢å·¥ä½œã€‚

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¸®åŠ©ä½ ä¸“æ³¨å­¦ä¹  Next.js çš„ä¸»è¦åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ç¼–å†™ä¸€ä¸ªåº”ç”¨çš„ *å…¨éƒ¨* ä»£ç ã€‚

å®‰è£…ä¹‹åï¼Œåœ¨ä»£ç ç¼–è¾‘å™¨ä¸­æ‰“å¼€é¡¹ç›®ï¼Œç„¶åæ‰“å¼€ `nextjs-dashboard`ã€‚

```shell
cd nextjs-dashboard
```
{: .nolineno}

è®©æˆ‘ä»¬èŠ±äº›æ—¶é—´çœ‹çœ‹è¿™ä¸ªé¡¹ç›®ã€‚

#### æ–‡ä»¶å¤¹ç»“æ„

ä½ ä¼šå‘ç°è¿™ä¸ªé¡¹ç›®æœ‰ç€å¦‚ä¸‹çš„æ–‡ä»¶å¤¹ç»“æ„ï¼š

![learn-folder-structure](learn-folder-structure.avif)

- **`/app`**ï¼šåŒ…å«äº†æ‰€æœ‰çš„è·¯ç”±ï¼Œç»„ä»¶ï¼Œå’Œåº”ç”¨çš„é€»è¾‘ä»£ç ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ä½ éƒ½åœ¨è¿™é‡Œå·¥ä½œã€‚
- **`/app/lib`**ï¼šåŒ…å«åº”ç”¨ä½¿ç”¨çš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸€äº›å¯å¤ç”¨çš„å·¥å…·å‡½æ•°æˆ–è€…æ•°æ®æŠ“å–å‡½æ•°ã€‚
- **`/app/ui`**ï¼šåŒ…å«äº†åº”ç”¨çš„ UI ç»„ä»¶ï¼Œæ¯”å¦‚é¡µé¢å¡ã€è¡¨æ ¼ã€è¡¨å•ç­‰ã€‚ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘ä»¬å·²ç»ä¸ºä½ ç¼–å†™å¥½äº†è¿™äº›ç»„ä»¶çš„æ ·å¼ä»£ç ã€‚
- **`/public`**ï¼šåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰é™æ€èµ„äº§ï¼Œæ¯”å¦‚å›¾ç‰‡ã€‚
- **`/scripts`**ï¼šåŒ…å«äº†ä¸€ä¸ªå¡«å……è„šæœ¬ï¼Œç”¨æ¥åœ¨ä¹‹åçš„ç« èŠ‚ä¸­å¡«å……æ•°æ®åº“ã€‚
- **é…ç½®æ–‡ä»¶**ï¼šåœ¨åº”ç”¨çš„æ ¹ç›®å½•ä¸‹è¿˜ä¼šæœ‰ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ `next.config.js`{: .filepath}ã€‚å¤§éƒ¨åˆ†æ–‡ä»¶éƒ½åœ¨ä½ ä½¿ç”¨ `create-next-app` åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®çš„æ—¶å€™ä¸ºä½ åˆ›å»ºå¹¶é…ç½®å¥½äº†ã€‚æœ¬æ•™ç¨‹ä¸­ä½ ä¸éœ€è¦ä¿®æ”¹è¿™äº›æ–‡ä»¶ã€‚

ä½ å¯ä»¥å°½ç®¡æµè§ˆæ–‡ä»¶å¤¹é‡Œçš„æ‰€æœ‰å†…å®¹ï¼Œå¦‚æœæœ‰ä¸æ‡‚çš„ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒã€‚

#### å ä½æ•°æ®

å½“ä½ æ„å»ºç”¨æˆ·ç•Œé¢çš„æ—¶å€™ï¼Œæœ‰ä¸€äº›å ä½æ•°æ®æ€»æ˜¯å¥½çš„ã€‚å¦‚æœè¿˜æ²¡æœ‰æ•°æ®åº“æˆ–è€… API çš„è¯ï¼Œä½ å¯ä»¥ï¼š

- ä½¿ç”¨ JSON æ ¼å¼çš„æ•°æ®æˆ–è€… JavaScript å¯¹è±¡ä½œå ä½
- ä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡æ¯”å¦‚è¯´ [mockAPI](https://mockapi.io/)ã€‚

å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬åœ¨ `app/lib/placeholder-data.js`{: .filepath} ä¸­æä¾›äº†ä¸€äº›å ä½æ•°æ®ã€‚æ¯ä¸€ä¸ª JavaScript å¯¹è±¡éƒ½è¡¨ç¤ºæ•°æ®åº“é‡Œçš„ä¸€ä¸ªè¡¨ã€‚æ¯”å¦‚è¯´ï¼Œå¯¹äºå•æ®è¡¨ï¼š

```js
const invoices = [
  {
    customer_id: customers[0].id,
    amount: 15795,
    status: 'pending',
    date: '2022-12-06',
  },
  {
    customer_id: customers[1].id,
    amount: 20348,
    status: 'pending',
    date: '2022-11-14',
  },
  // ...
];
```

åœ¨[è®¾ç½®æ•°æ®åº“](#ç¬¬å…­ç« -è®¾ç½®æ•°æ®åº“)çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨è¿™äº›æ•°æ®æ¥å¡«å……æ•°æ®åº“ï¼ˆåˆå§‹åŒ–æ•°æ®åº“ï¼‰ã€‚

#### TypeScript

ä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°äº†å¾ˆå¤šæ–‡ä»¶éƒ½æœ‰ `.ts` æˆ–è€… `.tsx` åç¼€ã€‚è¿™æ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®æ˜¯ç”¨ TypeScript ç¼–å†™çš„ï¼Œæˆ‘ä»¬æƒ³è¦ç¼–å†™ä¸€ä¸ªç¬¦åˆç°ä»£ç½‘ç«™æ™¯è§‚çš„æ•™ç¨‹ã€‚

å¦‚æœä½ ä¸æ‡‚ TypeScript ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¼šåœ¨éœ€è¦çš„æ—¶å€™æä¾› TypeScript ä»£ç ç‰‡æ®µã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ `/app/lib/definitions.ts`{: .filepath} è¿™ä¸ªæ–‡ä»¶ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨å®šä¹‰äº†ä¸€äº›ä¼šä»æ•°æ®åº“è¿”å›çš„ç±»å‹ï¼Œæ¯”å¦‚è¯´ï¼Œå•æ®è¡¨ä¼šè¿”å›å¦‚ä¸‹ç±»å‹ï¼š

```ts
export type Invoice = {
  id: string;
  customer_id: string;
  amount: number;
  date: string;
  // In TypeScript, this is called a string union type.
  // It means that the "status" property can only be one of the two strings: 'pending' or 'paid'.
  status: 'pending' | 'paid';
};
```

ä½¿ç”¨ TypeScript å¯ä»¥é¿å…ä½ ä¸å°å¿ƒæŠŠé”™è¯¯çš„æ•°æ®ç±»å‹ä¼ é€’ç»™ä½ çš„ç»„ä»¶æˆ–è€…æ•°æ®åº“ï¼Œæ¯”å¦‚è¯´æŠŠä¸€ä¸ª `string` å½“ä½œ `number` ä¼ é€’ç»™äº† `amount`ã€‚

> **å¦‚æœä½ æ˜¯ä¸€ä¸ª TypeScript å¼€å‘è€…ï¼š**
> - è¿™é‡Œæˆ‘ä»¬æ‰‹åŠ¨å£°æ˜äº†æ•°æ®ç±»å‹ï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½çš„ç±»å‹å®‰å…¨ï¼Œæˆ‘ä»¬æ¨èç”¨ [Prisma](https://www.prisma.io/)ï¼Œå®ƒå¯ä»¥æ ¹æ®ä½ çš„æ•°æ®è¡¨ç»“æ„è‡ªåŠ¨ç”Ÿæˆç±»å‹ã€‚
> - Next.js ä¼šæ£€æµ‹ä½ çš„é¡¹ç›®æ˜¯å¦ä½¿ç”¨äº† TypeScriptï¼Œå¦‚æœä½¿ç”¨äº†ä¼šè‡ªåŠ¨å®‰è£…å¿…è¦çš„åŒ…å’Œè®¾ç½®ã€‚Next.js ä¹Ÿæœ‰ä¸€ä¸ª [TypeScript æ’ä»¶](https://nextjs.org/docs/app/building-your-application/configuring/typescript#typescript-plugin)ï¼Œå¯ä»¥å®‰è£…åœ¨ä»£ç ç¼–è¾‘å™¨ä¸Šå¸®åŠ©ä½ è‡ªåŠ¨è¡¥å…¨å’Œä¿è¯ç±»å‹å®‰å…¨ã€‚

### è¿è¡Œå¼€å‘æœåŠ¡å™¨

è¿è¡Œ `npm i` å®‰è£…é¡¹ç›®çš„åŒ…

```shell
npm i
```
{: .nolineno}

ç„¶åè¿è¡Œ `npm run dev` æ‰“å¼€å¼€å‘æœåŠ¡å™¨

```shell
npm run dev
```
{: .nolineno}

`npm run dev` ä¼šåœ¨ `3000` ç«¯å£ä¸Šæ‰“å¼€ä¸€ä¸ª Next.js å¼€å‘æœåŠ¡å™¨ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ˜¯å¦ç®¡ç”¨ã€‚åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€ http://localhost:3000 ï¼Œä½ çš„ä¸»é¡µåº”è¯¥åƒä¸‹é¢è¿™æ ·ï¼š

![acme-unstyled](acme-unstyled.avif)

## ç¬¬äºŒç«  CSS æ ·å¼

ç›®å‰ä¸ºæ­¢ï¼Œä½ çš„ä¸»é¡µä¸Šè¿˜æ²¡æœ‰ä»»ä½•æ ·å¼ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢å‡ ç§ç»™ Next.js åº”ç”¨è®¾ç½®æ ·å¼çš„ä¸åŒæ–¹å¼ã€‚

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - æ€ä¹ˆä¸ºåº”ç”¨æ·»åŠ å…¨å±€ CSS æ–‡ä»¶ã€‚
> - ä¸¤ç§ä¸åŒçš„è®¾ç½®æ ·å¼çš„æ–¹å¼ï¼šTailwind å’Œ CSS modulesã€‚
> - å¦‚ä½•ä½¿ç”¨ `clsx` å·¥å…·åŒ…æœ‰é€‰æ‹©åœ°æ·»åŠ ç±»åã€‚

### å…¨å±€æ ·å¼

å¦‚æœä½ è§‚å¯Ÿ `/app/ui` æ–‡ä»¶å¤¹ï¼Œä½ ä¼šå‘ç°é‡Œé¢æœ‰ä¸€ä¸ªæ–‡ä»¶å« `global.css`ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ·»åŠ  CSS è§„åˆ™æ¥ç»™åº”ç”¨çš„ **æ‰€æœ‰** é¡µé¢æ·»åŠ æ ·å¼ï¼Œæ¯”å¦‚ CSS é‡ç½®è§„åˆ™ï¼ŒHTML å…ƒç´ ï¼ˆæ¯”å¦‚é“¾æ¥ï¼‰çš„å…¨ç«™æ ·å¼ç­‰ã€‚

ä½ å¯ä»¥åœ¨åº”ç”¨çš„ä»»æ„ç»„ä»¶å†…å¯¼å…¥ `global.css`ï¼Œä¸è¿‡é€šå¸¸æ¥è¯´æœ€å¥½æŠŠå®ƒåŠ å…¥åˆ°æœ€é¡¶çº§çš„ç»„ä»¶ä¸­ã€‚åœ¨ Next.js ä¸­ï¼Œè¿™ä¸ªé¡¶çº§ç»„ä»¶æ˜¯ [root layout](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts#root-layout-required)ï¼ˆç¨åè®¨è®ºï¼‰ã€‚

æ‰¾åˆ° `/app/layout.tsx` æ–‡ä»¶ï¼Œç„¶åå¯¼å…¥ `global.css` æ–‡ä»¶ï¼Œä»¥ä¸ºä½ çš„åº”ç”¨æ·»åŠ å…¨å±€æ ·å¼ã€‚

```tsx
import '@/app/ui/global.css';
 
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  );
}
```

ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£å¸¸è¿è¡Œï¼Œä¿å­˜ä¿®æ”¹ï¼Œç„¶ååœ¨æµè§ˆå™¨é‡ŒæŸ¥çœ‹ï¼Œä½ çš„ä¸»é¡µç°åœ¨åº”è¯¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![home-page-with-tailwind](home-page-with-tailwind.avif)

ä½†æ˜¯ç­‰ç­‰ï¼Œä½ å¹¶æ²¡æœ‰æ·»åŠ ä»»ä½• CSS è§„åˆ™ï¼Œè¿™äº›æ ·å¼æ˜¯å“ªæ¥çš„ï¼Ÿ

å¦‚æœä½ çœ‹ä¸€çœ‹ `global.css` çš„å†…å®¹çš„è¯ï¼Œä½ ä¼šå‘ç°æœ‰å‡ ä¸ª `@tailwind` å£°æ˜ï¼š

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

### Tailwind

[Tailwind](https://tailwindcss.com/) æ˜¯ä¸€ä¸ª CSS æ¡†æ¶ï¼Œé€šè¿‡å…è®¸æˆ‘ä»¬ç›´æ¥åœ¨ TSX æ ‡è®°è¯­è¨€ä¸­ç¼–å†™[è¾…åŠ©ç±»](https://tailwindcss.com/docs/utility-first)æ¥å¸®åŠ©æˆ‘ä»¬æé«˜å¼€å‘è¿›åº¦ã€‚

ä½¿ç”¨ Tailwind æ—¶ï¼Œä½ é€šè¿‡æ·»åŠ ç±»åæ¥ç»™å…ƒç´ æ·»åŠ æ ·å¼ï¼Œæ¯”å¦‚è¯´ï¼Œç»™ `<h1>` æ·»åŠ  `"text-blue-500"` ä¼šæŠŠæ–‡æœ¬å˜è“ï¼š

```html
<h1 className="text-blue-500">I'm blue!</h1>
```

å°½ç®¡ CSS æ ·å¼æ˜¯å…¨å±€å…±äº«çš„ï¼Œä½†æ˜¯æ¯ä¸ªç±»åªå•ç‹¬åº”ç”¨äºæ¯ä¸ªå…ƒç´ ã€‚è¿™æ„å‘³ç€å¦‚æœä½ æ·»åŠ æˆ–è€…åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œä½ ä¸ç”¨æ‹…å¿ƒå»ç»´æŠ¤é¢å¤–çš„æ ·å¼è¡¨ã€æ ·å¼å†²çªï¼Œæˆ–è€…æ‹…å¿ƒéšç€åº”ç”¨è¶Šæ¥è¶Šå¤§ä½ çš„ CSS åŒ…ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚

å½“ä½ ä½¿ç”¨ `create-next-app` åˆ›å»ºæ–°çš„é¡¹ç›®æ—¶ï¼ŒNext.js ä¼šè¯¢é—®ä½ æ˜¯å¦æƒ³è¦ç”¨ Tailwindã€‚å¦‚æœä½ é€‰æ‹© `yes`ï¼ŒNext.js ä¼šè‡ªåŠ¨å®‰è£…å¿…è¦çš„åŒ…å¹¶ä¸ºä½ çš„åº”ç”¨é…ç½® Tailwindã€‚

å¦‚æœä½ çœ‹ä¸€ä¸‹ `/app/page.tsx` æ–‡ä»¶ï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­æ­£åœ¨ä½¿ç”¨ Tailwind çš„ç±»ã€‚

```tsx
import AcmeLogo from '@/app/ui/acme-logo';
import { ArrowRightIcon } from '@heroicons/react/24/outline';
import Link from 'next/link';
 
export default function Page() {
  return (
    // These are Tailwind classes:
    <main className="flex min-h-screen flex-col p-6">
      <div className="flex h-20 shrink-0 items-end rounded-lg bg-blue-500 p-4 md:h-52">
    // ...
  )
}
```

å¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡ä½¿ç”¨ Tailwindï¼Œä¸å¿…æ‹…å¿ƒã€‚ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘ä»¬å·²ç»ä¸ºä½ æŠŠæ‰€æœ‰è¦ä½¿ç”¨çš„ç»„ä»¶éƒ½è®¾ç½®å¥½æ ·å¼äº†ã€‚

è®©æˆ‘ä»¬ç©ç© Tailwind å§ï¼æŠŠä¸‹é¢çš„ä»£ç æ‹·è´å¹¶ç²˜è´´åœ¨ `/app/page.tsx` æ–‡ä»¶çš„ `<p>` å…ƒç´ çš„ä¸Šé¢ã€‚

```html
<div
  className="h-0 w-0 border-b-[30px] border-l-[20px] border-r-[20px] border-b-black border-l-transparent border-r-transparent"
/>
```

å¦‚æœä½ æ›´å–œæ¬¢ä¼ ç»Ÿçš„ CSS è§„åˆ™ï¼Œæˆ–è€…ä½ æƒ³æŠŠä½ çš„æ ·å¼è·Ÿ JSX éš”ç¦»å¼€ï¼Œé‚£ä¹ˆ CSS Modules ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

### CSS Modules

[CSS Modules](https://nextjs.org/docs/basic-features/built-in-css-support) å¯ä»¥åœ¨ä½ æŠŠ CSS å†™å…¥åˆ°ç»„ä»¶ä¸­æ—¶è‡ªåŠ¨åˆ›å»ºå”¯ä¸€çš„ç±»åï¼Œè¿™æ ·ä½ ä¹Ÿä¸ç”¨æ‹…å¿ƒæ ·å¼å†²çªã€‚

åœ¨æœ¬æ•™ç¨‹æˆ‘ä»¬ä¼šä½¿ç”¨ Tailwindï¼Œä½†æ˜¯ä¹Ÿè®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹å¦‚ä½•ä½¿ç”¨ CSS Modules å®ç°ä¸Šä¾‹ä¸­ç›¸åŒçš„æ•ˆæœå§ã€‚

åœ¨ `/app/ui` ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `home.module.css` çš„æ–°æ–‡ä»¶ï¼Œç„¶åæ·»åŠ å¦‚ä¸‹è§„åˆ™ï¼š

```css
.shape {
  height: 0;
  width: 0;
  border-bottom: 30px solid black;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
}
```

ç„¶ååœ¨ `/app/page.tsx` æ–‡ä»¶ä¸­å¯¼å…¥æ ·å¼ï¼Œå¹¶æŠŠä½ ä¹‹å‰æ·»åŠ çš„ `<div>` ä¸­çš„ Tailwind ç±»åæ›¿æ¢ä¸º `styles.shape`ã€‚

```tsx
import styles from '@/app/ui/home.module.css';
 
//...
<div className="flex flex-col justify-center gap-6 rounded-lg bg-gray-50 px-6 py-10 md:w-2/5 md:px-20">
    <div className={styles.shape}></div>;
// ...
```

ä¿å­˜æ›´æ”¹å¹¶åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ•ˆæœã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªè·Ÿä¹‹å‰ä¸€æ ·çš„å›¾å½¢ã€‚

Tailwind å’Œ CSS Modules æ˜¯ç»™ Next.js åº”ç”¨æ·»åŠ æ ·å¼çš„ä¸¤å¤§å¸¸ç”¨æ–¹å¼ã€‚ç”¨å“ªä¸€ä¸ªçº¯ç²¹æ˜¯ä¸ªäººå–œå¥½äº†ï¼Œä½ ç”šè‡³ä¹Ÿå¯ä»¥éƒ½ç”¨ã€‚

### ä½¿ç”¨ `clsx` åº“æ¥åˆ‡æ¢ç±»å

å¯èƒ½æœ‰äº›æ—¶å€™ï¼Œä½ éœ€è¦æ ¹æ®ä¸€äº›çŠ¶æ€æˆ–è€…å…¶ä»–æƒ…å†µæ›´æ”¹å…ƒç´ çš„æ ·å¼ã€‚

[`clsx`](https://www.npmjs.com/package/clsx) æ˜¯ä¸€ä¸ªå¯ä»¥è®©ä½ è½»æ¾åˆ‡æ¢ç±»åçš„åº“ã€‚æˆ‘ä»¬å»ºè®®æŸ¥çœ‹[å®˜æ–¹æ–‡æ¡£](https://github.com/lukeed/clsx)äº†è§£æ›´å¤šç»†èŠ‚ï¼Œä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬ä½¿ç”¨ï¼š

- å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªåä¸º `InvoiceStatus` çš„ç»„ä»¶å¹¶æ¥æ”¶å‚æ•° `status`ï¼Œè¿™ä¸ªå‚æ•°å¯èƒ½æ˜¯ `"pending"` æˆ–è€… `"paid"`ã€‚
- å¦‚æœæ˜¯ `"paid"`ï¼Œé¢œè‰²å°±å˜ä¸ºç»¿è‰²ï¼Œå¦‚æœæ˜¯ `"pending"`ï¼Œé¢œè‰²å°±å˜ä¸ºç°è‰²ã€‚

ä½ å¯ä»¥ä½¿ç”¨ `clsx` æ¥æ ¹æ®æ¡ä»¶åº”ç”¨ä¸åŒçš„ç±»ï¼š

```tsx
import clsx from 'clsx';
 
export default function InvoiceStatus({ status }: { status: string }) {
  return (
    <span
      className={clsx(
        'inline-flex items-center rounded-full px-2 py-1 text-sm',
        {
          'bg-gray-100 text-gray-500': status === 'pending',
          'bg-green-500 text-white': status === 'paid',
        },
      )}
    >
    // ...
)}
```

### å…¶ä»–è®¾ç½®æ ·å¼çš„æ–¹æ¡ˆ

é™¤äº†æˆ‘ä»¬å‰é¢æåˆ°çš„æ–¹æ³•ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•ç»™ Next.js åº”ç”¨æ·»åŠ æ ·å¼ï¼š

- Sassï¼Œå®ƒå…è®¸ä½ å¯¼å…¥ `.css` å’Œ `.scss` æ–‡ä»¶ã€‚
- CSS-in-JS åº“ï¼Œæ¯”å¦‚ [styled-jsx](https://github.com/vercel/styled-jsx)ï¼Œ[styled-components](https://github.com/vercel/next.js/tree/canary/examples/with-styled-components)ï¼Œå’Œ [emotion](https://github.com/vercel/next.js/tree/canary/examples/with-emotion)ã€‚

æŸ¥çœ‹ [CSS æ–‡æ¡£](https://nextjs.org/docs/app/building-your-application/styling)äº†è§£æ›´å¤šä¿¡æ¯ã€‚

## ç¬¬ä¸‰ç«  ä¼˜åŒ–å­—ä½“å’Œå›¾ç‰‡

åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ç»™ Next.js åº”ç”¨è®¾ç½®æ ·å¼ã€‚ç°åœ¨è®©æˆ‘ä»¬ç»§ç»­è°ƒæ•´ä¸»é¡µï¼Œæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å­—ä½“å’Œä¸€å¼ ä¸»é¡µå›¾ã€‚

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - å¦‚ä½•ä½¿ç”¨ `next/font` æ·»åŠ è‡ªå®šä¹‰å­—ä½“ã€‚
> - å¦‚ä½•ä½¿ç”¨ `next/image` æ·»åŠ å›¾ç‰‡ã€‚
> - Next.js æ˜¯å¦‚ä½•ä¼˜åŒ–å­—ä½“å’Œå›¾ç‰‡çš„ã€‚

### ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–å­—ä½“ï¼Ÿ

å­—ä½“åœ¨ç½‘ç«™è®¾è®¡ä¸­å æ®äº†ç›¸å½“é‡è¦çš„ä½ç½®ï¼Œä½†å¦‚æœä½¿ç”¨è‡ªå®šä¹‰å­—ä½“æ—¶å­—ä½“æ–‡ä»¶éœ€è¦ä¸´æ—¶æŠ“å–å’ŒåŠ è½½ï¼Œé‚£ä¹ˆå°±ä¼šå¾ˆå½±å“é¡¹ç›®çš„æ€§èƒ½ã€‚

[ç´¯è®¡å¸ƒå±€åç§»](https://web.dev/cls/)ï¼ˆCLSï¼‰æ˜¯ä¸€é¡¹è°·æ­Œç”¨æ¥è¯„ä¼°ä¸€ä¸ªç½‘ç«™æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒçš„æŒ‡æ ‡ã€‚å½“ä¸€ä¸ªç½‘ç«™å…ˆç”¨å¤‡ç”¨å­—ä½“æˆ–è€…ç³»ç»Ÿå­—ä½“è¿›è¡Œåˆå§‹åŒ–æ¸²æŸ“ï¼Œç­‰è‡ªå®šä¹‰å­—ä½“åŠ è½½å®Œæˆåå†å°†å­—ä½“æ›¿æ¢ï¼Œè¿™æ ·å°±å‘ç”Ÿäº†å¸ƒå±€åç§»ã€‚è¿™ç§æ›¿æ¢ä¼šä½¿å¾—å­—ä½“å¤§å°ã€é—´éš”æˆ–è€…æ•´ä¸ªå¸ƒå±€å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä½¿å¾—å…¶å‘¨å›´çš„å…ƒç´ å‘ç”Ÿåç§»ã€‚

![font-layout-shift](font-layout-shift.avif)

å½“ä½ ä½¿ç”¨ `next/font` æ¨¡å—çš„æ—¶å€™ï¼ŒNext.js ä¼šè‡ªåŠ¨ä¸ºä½ çš„åº”ç”¨ä¼˜åŒ–å­—ä½“ã€‚å®ƒä¼šåœ¨æ„å»ºæ—¶æœŸæŠŠå­—ä½“æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åæŠŠå®ƒä»¬è·Ÿä½ çš„å…¶ä»–é™æ€æ–‡ä»¶æ”¾åœ¨ä¸€èµ·ç®¡ç†ã€‚è¿™æ„å‘³ç€å½“æœ‰äººè®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼Œç½‘ç«™ä¸éœ€è¦é¢å¤–çš„ç½‘ç»œè¯·æ±‚æ¥ä¸‹è½½å­—ä½“ï¼Œè¿™å°±æå‡äº†ç½‘ç«™æ€§èƒ½ã€‚

### æ·»åŠ ä¸»å­—ä½“

è®©æˆ‘ä»¬ä¸ºä½ çš„åº”ç”¨æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„è°·æ­Œå­—ä½“å§ï¼

åœ¨ `/app/ui` æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `fonts.ts` çš„æ–°æ–‡ä»¶ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥ä¿å­˜åº”ç”¨ä¸­æ‰€ä½¿ç”¨çš„å­—ä½“ã€‚

ä» `next/font/google` æ¨¡å—å¯¼å…¥ `Inter` å­—ä½“ï¼Œè¿™å°†ä¼šæ˜¯æˆ‘ä»¬çš„ä¸»å­—ä½“ã€‚ç„¶åæŒ‡å®šè¦åŠ è½½å“ªä¸€ä¸ª[å­é›†](https://fonts.google.com/knowledge/glossary/subsetting)ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ˜¯ `"latin"`ã€‚

```ts
import { Inter } from 'next/font/google';
 
export const inter = Inter({ subsets: ['latin'] });
```

æœ€åï¼Œåœ¨ `/app/layout.tsx` æ–‡ä»¶çš„ `<body>` å…ƒç´ ä¸­æ·»åŠ è¯¥å­—ä½“ã€‚

```tsx
import '@/app/ui/global.css';
import { inter } from '@/app/ui/fonts';
 
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={`${inter.className} antialiased`}>{children}</body>
    </html>
  );
}
```

ç»™ `<body>` å…ƒç´ æ·»åŠ  `Inter` ä¹‹åï¼Œè¿™ä¸ªå­—ä½“å°±ä¼šåº”ç”¨åˆ°æ•´ä¸ªåº”ç”¨ä¸­ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿæ·»åŠ äº†ä¸€ä¸ª Tailwind ç±»å `antialiased` æ¥ä½¿å­—ä½“æ›´å¹³æ»‘ã€‚è¿™ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯åŠ ä¸Šä¼šå¾ˆä¸é”™ã€‚

æ‰“å¼€æµè§ˆå™¨ï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œé€‰æ‹© `body` å…ƒç´ ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ° `Inter` å’Œ `Inter_Fallback` å‡ºç°åœ¨æ ·å¼ä¸­ã€‚

### ç»ƒä¹ ï¼šæ·»åŠ ç¬¬äºŒå­—ä½“

ä½ å¯ä»¥ç»™åº”ç”¨ä¸­ç‰¹å®šçš„å…ƒç´ æ·»åŠ å­—ä½“ã€‚

ç°åœ¨ä½ è‡ªå·±æ¥æ“ä½œå§ï¼åœ¨ `fonts.ts` æ–‡ä»¶ä¸­ï¼Œå¯¼å…¥åä¸º `Lusitana` çš„ç¬¬äºŒå­—ä½“ï¼Œç„¶åæŠŠå®ƒä¼ é€’ç»™ `/app/page.tsx` æ–‡ä»¶çš„ `<p>` å…ƒç´ ã€‚è¦åƒå‰é¢é‚£æ ·æŒ‡å®šå­—ä½“å­é›†çš„è¯ï¼Œä½ è¿˜éœ€è¦æŒ‡å®šå­—ä½“çš„ **å­—é‡**ã€‚

å½“ä½ å®Œæˆäº†ï¼Œå¯ä»¥å±•å¼€ä¸‹é¢çš„ä»£ç ç‰‡æ®µæŸ¥çœ‹è§£å†³æ–¹æ¡ˆã€‚

> **æç¤º**ï¼š
> - å¦‚æœä½ ä¸çŸ¥é“æ€ä¹ˆä¼ é€’å­—ä½“çš„å­—é‡é€‰é¡¹ï¼Œçœ‹ä¸€ä¸‹ä»£ç ç¼–è¾‘å™¨æŠ¥çš„ TypeScript é”™è¯¯ã€‚
> - è®¿é—®[è°·æ­Œå­—ä½“](https://fonts.google.com/)å¹¶æœç´¢ `Lusitana` æ¥æŸ¥çœ‹æœ‰å“ªäº›å­é›†å¯é€‰ã€‚
> - æŸ¥çœ‹æ–‡æ¡£äº†è§£å¦‚ä½•[æ·»åŠ å¤šä¸ªå­—ä½“](https://nextjs.org/docs/app/building-your-application/optimizing/fonts#using-multiple-fonts)å’Œ[æ‰€æœ‰å¯ç”¨é€‰é¡¹](https://nextjs.org/docs/app/api-reference/components/font#font-function-arguments)ã€‚

> è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼ˆå½“ç„¶æ— æ³•æŠ˜å å•¦~ï¼‰

```ts
import { Inter, Lusitana } from 'next/font/google';
 
export const inter = Inter({ subsets: ['latin'] });
 
export const lusitana = Lusitana({
  weight: ['400', '700'],
  subsets: ['latin'],
});
```
{: file="/app/ui/fonts.ts"}

```tsx
import AcmeLogo from '@/app/ui/acme-logo';
import { ArrowRightIcon } from '@heroicons/react/24/outline';
import Link from 'next/link';
import { lusitana } from '@/app/ui/fonts';
 
export default function Page() {
  return (
    // ...
    <p
      className={`${lusitana.className} text-xl text-gray-800 md:text-3xl md:leading-normal`}
    >
      <strong>Welcome to Acme.</strong> This is the example for the{' '}
      <a href="https://nextjs.org/learn/" className="text-blue-500">
        Next.js Learn Course
      </a>
      , brought to you by Vercel.
    </p>
    // ...
  );
}
```
{: file="/app/page.tsx"}

æœ€å `<AcmeLogo />` ç»„ä»¶ä¹Ÿä½¿ç”¨äº† Lusitana å­—ä½“ï¼Œä¹‹å‰è¢«æ³¨é‡Šäº†ï¼Œä¸ºäº†é˜²æ­¢æŠ¥é”™ï¼Œç°åœ¨ä½ å¯ä»¥ç§»é™¤å®ƒçš„æ³¨é‡Šäº†ã€‚

```tsx
// ...
 
export default function Page() {
  return (
    <main className="flex min-h-screen flex-col p-6">
      <div className="flex h-20 shrink-0 items-end rounded-lg bg-blue-500 p-4 md:h-52">
        <AcmeLogo />
        {/* ... */}
      </div>
    </main>
  );
}
```

å¾ˆå¥½ï¼Œä½ ç°åœ¨å·²ç»ç»™åº”ç”¨æ·»åŠ äº†ä¸¤ä¸ªè‡ªå®šä¹‰å­—ä½“äº†ï¼Œä¸‹é¢ï¼Œè®©æˆ‘ä»¬ç»™ä¸»é¡µæ·»åŠ ä¸€å¼ ä¸»é¡µå›¾ã€‚

### ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–å›¾ç‰‡ï¼Ÿ

Next.js åœ¨é¡¶å±‚æ–‡ä»¶å¤¹ `/public` ä¸­ç®¡ç†é™æ€èµ„æºï¼Œæ¯”å¦‚å›¾ç‰‡ã€‚`/public` æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶éƒ½å¯ä»¥è¢«åº”ç”¨ä½¿ç”¨ã€‚

ç”¨å¸¸è§„çš„ HTML è¯­æ³•ï¼Œä½ éœ€è¦åƒè¿™æ ·æ·»åŠ å›¾ç‰‡ï¼š

```html
<img
  src="/hero.png"
  alt="Screenshots of the dashboard project showing desktop version"
/>
```

ç„¶è€Œï¼Œè¿™ä¹Ÿæ„å‘³ç€ä½ éœ€è¦æ‰‹åŠ¨åšè¿™äº›ï¼š

- ç¡®ä¿ä½ çš„å›¾ç‰‡å¯ä»¥åœ¨ä¸åŒçš„å±å¹•å¤§å°ä¸Šåšå‡ºåˆé€‚çš„å“åº”
- ä¸ºä¸åŒçš„è®¾å¤‡æŒ‡å®šå›¾ç‰‡å¤§å°
- é˜²æ­¢å›¾ç‰‡åŠ è½½æ—¶é€ æˆçš„å¸ƒå±€åç§»
- åœ¨ç”¨æˆ·è§†çª—ä¹‹å¤–æ—¶å»¶è¿ŸåŠ è½½å›¾ç‰‡

å›¾ç‰‡ä¼˜åŒ–æ˜¯ç½‘ç«™å¼€å‘ä¸­çš„ä¸€ä¸ªå¤§è¯é¢˜ï¼Œç”šè‡³å¯ä»¥è‡ªæˆä¸€æ´¾ã€‚ä¸ºäº†é¿å…æ‰‹åŠ¨å®ç°è¿™äº›ä¼˜åŒ–ç»†èŠ‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ `next/image` ç»„ä»¶æ¥è‡ªåŠ¨ä¼˜åŒ–å›¾ç‰‡ã€‚

### `<Image>` ç»„ä»¶

`<Image>` ç»„ä»¶æ˜¯å¯¹ HTML `<img>` æ ‡ç­¾çš„æ‰©å±•ï¼Œå…·æœ‰è‡ªåŠ¨å›¾ç‰‡ä¼˜åŒ–çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- åœ¨å›¾ç‰‡åŠ è½½æ—¶é˜²æ­¢è‡ªåŠ¨å¸ƒå±€åç§»
- å¯ä»¥è‡ªåŠ¨è°ƒæ•´å¤§å°ï¼Œä»¥é¿å…åœ¨å°çª—å£çš„è®¾å¤‡ä¸ŠåŠ è½½å¤§å›¾ç‰‡
- é»˜è®¤å»¶è¿ŸåŠ è½½å›¾ç‰‡ï¼ˆå½“è¿›å…¥ç”¨æˆ·è§†çª—æ—¶åŠ è½½å›¾ç‰‡ï¼‰
- å¦‚æœæµè§ˆå™¨æ”¯æŒçš„è¯ï¼Œç”¨ç°ä»£çš„å›¾ç‰‡æ ¼å¼ï¼Œå¦‚ [WebP](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types#webp) å’Œ [AVIF](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types#avif_image) ç®¡ç†å›¾ç‰‡

### æ·»åŠ æ¡Œé¢ç«¯ä¸»é¡µå›¾

è®©æˆ‘ä»¬æ¥ä½¿ç”¨ `<Image>` ç»„ä»¶å§ã€‚å¦‚æœä½ æ‰“å¼€ `/public` æ–‡ä»¶å¤¹ï¼Œä½ ä¼šçœ‹åˆ°æœ‰ä¸¤å¼ å›¾ç‰‡ï¼š`hero-desktop.png` å’Œ `hero-mobile.png`ã€‚ä¸¤å¼ å›¾å®Œå…¨ä¸åŒï¼Œå®ƒä»¬ä¸€å¼ ç”¨äºæ˜¾ç¤ºåœ¨æ¡Œé¢ç«¯è®¾å¤‡ï¼Œå¦ä¸€å¼ ç”¨äºç§»åŠ¨ç«¯ã€‚

åœ¨ `/app/page.psx` æ–‡ä»¶ä¸­ï¼Œä» [`next/image`](https://nextjs.org/docs/api-reference/next/image) ä¸­å¯¼å…¥ç»„ä»¶ï¼Œç„¶ååœ¨æ³¨é‡Šä¸‹é¢æ·»åŠ å›¾ç‰‡ï¼š

```tsx
import AcmeLogo from '@/app/ui/acme-logo';
import { ArrowRightIcon } from '@heroicons/react/24/outline';
import Link from 'next/link';
import { lusitana } from '@/app/ui/fonts';
import Image from 'next/image';
 
export default function Page() {
  return (
    // ...
    <div className="flex items-center justify-center p-6 md:w-3/5 md:px-28 md:py-12">
      {/* Add Hero Images Here */}
      <Image
        src="/hero-desktop.png"
        width={1000}
        height={760}
        className="hidden md:block"
        alt="Screenshots of the dashboard project showing desktop version"
      />
    </div>
    //...
  );
}
```

è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠ `width` è®¾ç½®ä¸º `1000` åƒç´ ï¼ŒæŠŠ `height` è®¾ç½®ä¸º `760` åƒç´ ã€‚æ‰‹åŠ¨è®¾ç½®å›¾ç‰‡çš„å®½é«˜æ¥é¿å…å¸ƒå±€åç§»æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Œè¿™ä¸ªå®½é«˜æ¯”éœ€è¦è·ŸåŸå›¾ç‰‡çš„å®½é«˜æ¯” **ç›¸åŒ**ã€‚

è¿™é‡Œæˆ‘ä»¬è¿˜æ·»åŠ äº† `hidden` ç±»æ¥ä»ç§»åŠ¨ç«¯å±å¹•ä¸­ç§»é™¤å›¾ç‰‡ï¼Œå’Œ `md:block` æ¥åœ¨æ¡Œé¢ç«¯å±å¹•ä¸­æ˜¾ç¤ºå›¾ç‰‡ã€‚

![home-page-with-hero](home-page-with-hero.avif)

### ç»ƒä¹ ï¼šæ·»åŠ ç§»åŠ¨ç«¯çš„ä¸»é¡µå›¾

ç°åœ¨åˆ°ä½ äº†ï¼åœ¨åˆšæ‰æ·»åŠ çš„å›¾ç‰‡ä¸‹é¢ï¼Œæ·»åŠ ä¸€å¼  `hero-mobile.png` çš„ `<Image>` ç»„ä»¶ã€‚

- å›¾ç‰‡çš„ `width` åº”è¯¥ä¸º `560` åƒç´ ï¼Œ`height` åº”è¯¥ä¸º `620` åƒç´ ã€‚
- å›¾ç‰‡åº”è¯¥åœ¨ç§»åŠ¨ç«¯å±å¹•ä¸Šæ˜¾ç¤ºï¼Œåœ¨æ¡Œé¢ç«¯éšè—ã€‚ä½ å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…·æŸ¥çœ‹å›¾ç‰‡åœ¨æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯ä¸­æ˜¯å¦æ­£å¸¸åˆ‡æ¢ã€‚

å½“ä½ å®Œæˆä¹‹åï¼Œå¯ä»¥å±•å¼€ä¸‹é¢çš„ä»£ç æŸ¥çœ‹è§£å†³æ–¹æ¡ˆã€‚

> è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼ˆå½“ç„¶æ— æ³•æŠ˜å å•¦~ï¼‰

```tsx
import AcmeLogo from '@/app/ui/acme-logo';
import { ArrowRightIcon } from '@heroicons/react/24/outline';
import Link from 'next/link';
import { lusitana } from '@/app/ui/fonts';
import Image from 'next/image';
 
export default function Page() {
  return (
    // ...
    <div className="flex items-center justify-center p-6 md:w-3/5 md:px-28 md:py-12">
      {/* Add Hero Images Here */}
      <Image
        src="/hero-desktop.png"
        width={1000}
        height={760}
        className="hidden md:block"
        alt="Screenshots of the dashboard project showing desktop version"
      />
      <Image
        src="/hero-mobile.png"
        width={560}
        height={620}
        className="block md:hidden"
        alt="Screenshot of the dashboard project showing mobile version"
      />
    </div>
    //...
  );
}
```
{: file="/app/page.tsx"}

å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬çš„ä¸»é¡µæœ‰è‡ªå®šä¹‰å­—ä½“å’Œä¸»é¡µå›¾äº†ã€‚

### æ¨èé˜…è¯»

å…³äºè¿™äº›è¯é¢˜ï¼Œè¿˜æœ‰å¾ˆå¤šå†…å®¹ï¼Œæ¯”å¦‚ä¼˜åŒ–è¿œç¨‹å›¾ç‰‡ï¼Œæˆ–è€…ä½¿ç”¨æœ¬åœ°çš„å­—ä½“æ–‡ä»¶ç­‰ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šå†…å®¹ï¼Œå¯ä»¥é˜…è¯»ä¸‹é¢çš„æ–‡æ¡£ï¼š

- [å›¾ç‰‡ä¼˜åŒ–æ–‡æ¡£](https://nextjs.org/docs/app/building-your-application/optimizing/images)
- [å­—ä½“ä¼˜åŒ–æ–‡æ¡£](https://nextjs.org/docs/app/building-your-application/optimizing/fonts)
- [ä»å›¾ç‰‡è§’åº¦æå‡ç½‘ç«™æ€§èƒ½ï¼ˆMDNï¼‰](https://developer.mozilla.org/en-US/docs/Learn/Performance/Multimedia)
- [ç½‘ç«™å­—ä½“ï¼ˆMDNï¼‰](https://developer.mozilla.org/en-US/docs/Learn/CSS/Styling_text/Web_fonts)

## ç¬¬å››ç«  åˆ›å»ºå¸ƒå±€å’Œé¡µé¢

ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„åº”ç”¨åªæœ‰ä¸€ä¸ªä¸»é¡µã€‚ç°åœ¨è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•ä½¿ç”¨ **å¸ƒå±€** å’Œ **é¡µé¢** æ¥åˆ›å»ºæ›´å¤šåˆ†é¡µã€‚

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯ç”±åˆ›å»º `dashboard` åˆ†é¡µ
> - ç†è§£æ–‡ä»¶å¤¹å’Œæ–‡ä»¶åœ¨åˆ›å»ºæ–°åˆ†é¡µæ—¶çš„ä½œç”¨
> - åˆ›å»ºä¸€ä¸ªåµŒå¥—çš„å¸ƒå±€ï¼Œä»¥ä¾¿åœ¨å¤šä¸ªä»ªè¡¨ç›˜åˆ†é¡µä¸­å…±äº«ä½¿ç”¨
> - ç†è§£ä»€ä¹ˆæ˜¯æ‰˜ç®¡ã€å±€éƒ¨æ¸²æŸ“å’Œæ ¹å¸ƒå±€ï¼ˆroot layoutï¼‰

### åµŒå¥—è·¯ç”±

Next.js ä½¿ç”¨çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿè·¯ç”±ï¼Œå…¶ä¸­ **æ–‡ä»¶å¤¹** è¢«ç”¨æ¥åµŒå¥—åˆ†é¡µã€‚æ¯ä¸€ä¸ªæ–‡ä»¶å¤¹ä»£è¡¨äº†ä¸€ä¸ª **æ®µè·¯ç”±**ï¼Œæ˜ å°„åˆ°ç½‘å€ä¸Šå°±æ˜¯ä¸€ä¸ª **URL æ®µ**ã€‚

![folders-to-url-segments](folders-to-url-segments.avif)

ä½ å¯ä»¥ä½¿ç”¨ `layout.tsx` å’Œ `page.tsx` æ–‡ä»¶ä¸ºæ¯ä¸€ä¸ªåˆ†é¡µåˆ›å»ºä¸åŒçš„ UIã€‚

`page.tsx` æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Next.js æ–‡ä»¶ï¼Œå®ƒå¯¼å‡ºäº†ä¸€ä¸ª React ç»„ä»¶ï¼Œè¦æƒ³è®©åˆ†é¡µå˜å¾—å¯è®¿é—®å°±å¾—éœ€è¦å®ƒã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶äº†ï¼š`/app/page.tsx`ã€‚å®ƒæ˜¯ `/` è·¯ç”±æ®µå¯¹åº”çš„ä¸»é¡µé¢ã€‚

è¦åœ¨å…¶ä¸‹åˆ›å»ºåˆ†é¡µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨æ–‡ä»¶å¤¹å†…åˆ›å»º `page.tsx` æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š

![static-site-generation](static-site-generation.avif)

`/app/dashboard/page.tsx` å¯¹åº”çš„æ˜¯ `/dashboard` ç½‘å€è·¯å¾„ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé¡µé¢çœ‹çœ‹å¦‚ä½•ã€‚

### åˆ›å»ºä¸€ä¸ªä»ªè¡¨ç›˜é¡µé¢

åœ¨ `/app` å†…åˆ›å»ºä¸€ä¸ªåä¸º `dashboard` çš„æ–‡ä»¶å¤¹ã€‚ç„¶ååœ¨è¯¥æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªæ–°çš„ `page.tsx` æ–‡ä»¶ï¼Œå¹¶åŒ…å«å¦‚ä¸‹å†…å®¹ï¼š

```tsx
export default function Page() {
  return <p>Dashboard Page</p>;
}
```

ç°åœ¨ï¼Œç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œç„¶åè®¿é—® http://localhost:3000/dashboard ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ° â€œDashboard Pageâ€ å­—æ ·ã€‚

è¿™å°±æ˜¯å¦‚ä½•åœ¨ Next.js ä¸­åˆ›å»ºä¸åŒçš„é¡µé¢çš„æ–¹å¼äº†ï¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä»£è¡¨ä¸€ä¸ªæ–°çš„æ®µè·¯ç”±ï¼Œç„¶åæ·»åŠ ä¸€ä¸ª `page` æ–‡ä»¶ã€‚

é€šè¿‡è¿™ä¸ªæœ‰ç‰¹æ®Šåå­—çš„ `page` æ–‡ä»¶ï¼ŒNext.js å…è®¸æˆ‘ä»¬å¯ä»¥åœ¨æ­¤è·¯ç”±ä¸‹[æ‰˜ç®¡](https://nextjs.org/docs/app/building-your-application/routing#colocation) UI ç»„ä»¶ã€æµ‹è¯•æ–‡ä»¶ï¼Œå’Œå…¶ä»–ç›¸å…³çš„ä»£ç ã€‚åªæœ‰ `page` æ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯å…¬å¼€çš„ã€‚æ¯”å¦‚ `/ui` å’Œ `/lib` æ–‡ä»¶å¤¹æ˜¯è·Ÿå…¶ä»–è·¯ç”±ä¸€èµ· *æ‰˜ç®¡* åœ¨ `/app` ä¸­çš„ã€‚

> è¯‘æ³¨ï¼šå…¶å®æˆ‘æ²¡æ€ä¹ˆç†è§£è¿™å¥è¯ã€‚

### ç»ƒä¹ ï¼šåˆ›å»ºå…¶ä»–ä»ªè¡¨ç›˜é¡µé¢

è®©æˆ‘ä»¬ç»ƒä¹ åˆ›å»ºæ›´å¤šåˆ†é¡µå§ã€‚åœ¨æˆ‘ä»¬çš„ `dashboard` ä¸­ï¼Œåˆ›å»ºä¸‹é¢ä¸¤ä¸ªé¡µé¢ï¼š

1. **å®¢æˆ·åˆ†é¡µ**ï¼šè¯¥åˆ†é¡µåº”è¯¥é€šè¿‡ http://localhost:3000/dashboard/customers è®¿é—®ï¼Œç°åœ¨è¯¥é¡µé¢å¯ä»¥åªè¿”å›ä¸€ä¸ª `<p>Customers Page</p>` å…ƒç´ ã€‚
2. **å•æ®åˆ†é¡µ**ï¼šè¯¥åˆ†é¡µåº”è¯¥é€šè¿‡ http://localhost:3000/dashboard/invoices è®¿é—®ï¼Œç°åœ¨è¯¥åˆ†é¡µå¯ä»¥åªè¿”å›ä¸€ä¸ª `<p>Invoices Page</p>` å…ƒç´ ã€‚

èŠ±äº›æ—¶é—´æ•´æ•´è¿™ä¸ªç»ƒä¹ ï¼Œå½“ä½ å®Œæˆåï¼Œå±•å¼€ä¸‹é¢çš„ä»£ç æŸ¥çœ‹è§£å†³æ–¹æ¡ˆã€‚

> è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼ˆå½“ç„¶æ— æ³•æŠ˜å å•¦~ï¼‰

ä½ åº”è¯¥æœ‰å¦‚ä¸‹æ–‡ä»¶å¤¹ç»“æ„ï¼š

![routing-solution](routing-solution.avif)

```tsx
export default function Page() {
  return <p>Customers Page</p>;
}
```
{: file="/app/dashboard/customers/page.tsx"}

```tsx
export default function Page() {
  return <p>Invoices Page</p>;
}
```
{: file="/app/dashboard/invoices/page.tsx"}

### åˆ›å»ºä»ªè¡¨ç›˜å¸ƒå±€

ä»ªè¡¨ç›˜æœ‰ä¸€äº›å¯ä»¥åœ¨å¤šä¸ªé¡µé¢ä¸­å…±äº«çš„å¯¼èˆªåŒºåŸŸã€‚åœ¨ Next.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ `layout.tsx` æ¥åˆ›å»ºå¯ä»¥åœ¨å¤šä¸ªé¡µé¢ä¸­å…±äº«çš„ UIã€‚è®©æˆ‘ä»¬ä¸ºä»ªè¡¨ç›˜é¡µé¢åˆ›å»ºä¸€ä¸ªå¸ƒå±€å§ï¼

åœ¨ `/dashboard` æ–‡ä»¶å¤¹å†…ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º `layout.tsx` çš„æ–°æ–‡ä»¶ï¼Œå¹¶ç²˜è´´å¦‚ä¸‹ä»£ç ï¼š

```tsx
import SideNav from '@/app/ui/dashboard/sidenav';
 
export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <div className="flex h-screen flex-col md:flex-row md:overflow-hidden">
      <div className="w-full flex-none md:w-64">
        <SideNav />
      </div>
      <div className="flex-grow p-6 md:overflow-y-auto md:p-12">{children}</div>
    </div>
  );
}
```

è¿™æ®µä»£ç åŒ…å«äº†å‡ æ–¹é¢å†…å®¹ï¼Œæˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹çœ‹ï¼š

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨å¸ƒå±€ä¸­å¯¼å…¥äº† `<SideNav />` ç»„ä»¶ã€‚ä½ åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å¯¼å…¥çš„ä»»ä½•ç»„ä»¶éƒ½ä¼šæˆä¸ºè¿™ä¸ªå¸ƒå±€çš„ä¸€éƒ¨åˆ†ã€‚

`<Layout />` ç»„ä»¶æ¥å—ä¸€ä¸ª `children` å±æ€§ï¼Œè¿™ä¸ªå­ç»„ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªé¡µé¢æˆ–è€…æ˜¯å…¶ä»–çš„å¸ƒå±€ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåœ¨ `/dashboard` ä¹‹ä¸‹çš„é¡µé¢ä¼šè‡ªåŠ¨åµŒå¥—è¿› `<Layout />` ä¸­ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š

![shared-layout](shared-layout.avif)

ä¿å­˜æ›´æ”¹ï¼Œæ£€æŸ¥ç½‘é¡µï¼Œç¡®ä¿ä¸€åˆ‡è¿è¡Œæ­£å¸¸ã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š

![shared-layout-page](shared-layout-page.avif)

åœ¨ Next.js ä¸­ä½¿ç”¨å¸ƒå±€çš„å…¶ä¸­ä¸€ä¸ªå¥½å¤„å°±æ˜¯æ–¹ä¾¿å¯¼èˆªï¼Œåªæœ‰é¡µé¢çš„ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“è€Œå¸ƒå±€çš„ä¸ä¼šï¼Œè¿™å°±å«[å±€éƒ¨æ¸²æŸ“](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#3-partial-rendering)ã€‚

![partial-rendering-dashboard](partial-rendering-dashboard.avif)

### æ ¹å¸ƒå±€

åœ¨ç¬¬ä¸‰ç« ï¼Œæˆ‘ä»¬åœ¨å¦ä¸€ä¸ªå¸ƒå±€æ–‡ä»¶ `/app/layout.tsx` ä¸­å¯¼å…¥äº†ä¸€ä¸ª `Inter` å­—ä½“ï¼Œå¦‚ä¸‹

```tsx
import '@/app/ui/global.css';
import { inter } from '@/app/ui/fonts';
 
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={`${inter.className} antialiased`}>{children}</body>
    </html>
  );
}
```

è¿™ä¸ªæ˜¯æ ¹å¸ƒå±€ï¼ˆ[root layout](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts#root-layout-required)ï¼‰ï¼Œæ˜¯å¿…éœ€çš„ã€‚ä½ åœ¨æ ¹å¸ƒå±€ä¸­æ·»åŠ çš„ä»»ä½• UI éƒ½ä¼šåœ¨åº”ç”¨çš„ **æ‰€æœ‰** é¡µé¢ä¸Šå…±äº«ã€‚ä½ å¯ä»¥ä½¿ç”¨æ ¹å¸ƒå±€æ¥ä¿®æ”¹ `<html>` å’Œ `<body>` æ ‡ç­¾ï¼Œæˆ–è€…æ·»åŠ å…ƒæ•°æ®ï¼ˆæˆ‘ä»¬ä¼šåœ¨[ä¹‹åçš„ç« èŠ‚](#ç¬¬åå…­ç« -æ·»åŠ å…ƒæ•°æ®)ä¸­å­¦ä¹ å…ƒæ•°æ®ï¼‰ã€‚

## ç¬¬äº”ç«  åœ¨é¡µé¢é—´å¯¼èˆª

åœ¨ä¸Šä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä»ªè¡¨ç›˜çš„å¸ƒå±€å’Œé¡µé¢ã€‚ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›é“¾æ¥ï¼Œæ¥å…è®¸ç”¨æˆ·åœ¨ä¸åŒçš„åˆ†é¡µé—´è·³è½¬ã€‚

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - å¦‚ä½•ä½¿ç”¨ `next/link` ç»„ä»¶
> - å¦‚ä½•ä½¿ç”¨ `usePathname()` é’©å­æ˜¾ç¤ºå½“å‰æ¿€æ´»çš„é“¾æ¥
> - Next.js çš„å¯¼èˆªæ˜¯å¦‚ä½•è¿ä½œçš„

### ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–å¯¼èˆªï¼Ÿ

è¦åœ¨ä¸åŒçš„é¡µé¢é—´å»ºç«‹é“¾æ¥ï¼Œä½ é€šå¸¸ä¼šéœ€è¦ HTML çš„ `<a>` æ ‡ç­¾ã€‚ç›®å‰ä¸ºæ­¢ï¼Œä¾§è¾¹æ çš„é“¾æ¥å°±æ˜¯ç”¨ `<a>` é“¾æ¥çš„ï¼Œä½†æ˜¯è§‚å¯Ÿä¸€ä¸‹ï¼Œå½“ä½ åœ¨ä¸»é¡µã€å•æ®é¡µã€å®¢æˆ·é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

çœ‹åˆ°äº†å—ï¼Ÿ

æ¯æ¬¡è·³è½¬ï¼Œæ•´ä¸ªé¡µé¢éƒ½åˆ·æ–°äº†ï¼

### `<Link>` ç»„ä»¶

åœ¨ Next.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ `<Link />` ç»„ä»¶æ¥é“¾æ¥åº”ç”¨ä¸­çš„ä¸åŒé¡µé¢ã€‚`<Link>` å…è®¸ä½ ä½¿ç”¨ JavaScript å®ç°[å®¢æˆ·ç«¯å¯¼èˆª](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#how-routing-and-navigation-works)ã€‚

è¦ä½¿ç”¨ `<Link />` ç»„ä»¶ï¼Œæ‰“å¼€ `/app/ui/dashboard/nav-links.tsx`ï¼Œä» `next/link` å¯¼å…¥ `Link` ç»„ä»¶ï¼Œç„¶åæŠŠ `<a>` æ ‡ç­¾æ›¿æ¢ä¸º `<Link>`ã€‚

```tsx
import {
  UserGroupIcon,
  HomeIcon,
  DocumentDuplicateIcon,
} from '@heroicons/react/24/outline';
import Link from 'next/link';
 
// ...
 
export default function NavLinks() {
  return (
    <>
      {links.map((link) => {
        const LinkIcon = link.icon;
        return (
          <Link
            key={link.name}
            href={link.href}
            className="flex h-[48px] grow items-center justify-center gap-2 rounded-md bg-gray-50 p-3 text-sm font-medium hover:bg-sky-100 hover:text-blue-600 md:flex-none md:justify-start md:p-2 md:px-3"
          >
            <LinkIcon className="w-6" />
            <p className="hidden md:block">{link.name}</p>
          </Link>
        );
      })}
    </>
  );
}
```

æ­£å¦‚ä½ æ‰€è§ï¼Œ`Link` ç»„ä»¶çš„ç”¨æ³•è·Ÿ `<a>` å¾ˆç›¸ä¼¼ã€‚

ä¿å­˜æ›´æ”¹ï¼Œç„¶ååˆ°æµè§ˆå™¨æŸ¥çœ‹ç½‘é¡µã€‚ä½ ç°åœ¨åœ¨é¡µé¢é—´å¯¼èˆªåº”è¯¥å°±ä¸ä¼šå‡ºç°ä¸€æ•´ä¸ªé¡µé¢éƒ½åˆ·æ–°çš„é—®é¢˜äº†ã€‚å°½ç®¡è¿™ä¸ªåº”ç”¨çš„ä¸€éƒ¨åˆ†æ˜¯åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ï¼Œä½†æ˜¯ä¸ä¼šå‡ºç°æ•´ä¸ªé¡µé¢éƒ½åˆ·æ–°çš„é—®é¢˜äº†ï¼Œå°±åƒä¸€ä¸ªç½‘é¡µåº”ç”¨ä¸€æ ·ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

#### è‡ªåŠ¨çš„ä»£ç åˆ†å‰²å’Œé¢„è·å–

ä¸ºäº†æå‡å¯¼èˆªä½“éªŒï¼ŒNext.js ä¼šæ ¹æ®æ®µè·¯ç”±è‡ªåŠ¨è¿›è¡Œä»£ç åˆ†å‰²ã€‚è¿™è·Ÿä¼ ç»Ÿçš„ React [å•é¡µåº”ç”¨](https://developer.mozilla.org/en-US/docs/Glossary/SPA)ä¸åŒï¼Œåè€…æ˜¯åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶åŠ è½½å…¨éƒ¨çš„ä»£ç ã€‚

æ ¹æ®è·¯ç”±åˆ†å‰²ä»£ç æ„å‘³ç€é¡µé¢ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚å¦‚æœæŸä¸€ä¸ªé¡µé¢æŠ¥é”™äº†ï¼Œå‰©ä¸‹çš„é¡µé¢ä¾æ—§èƒ½æ­£å¸¸å·¥ä½œã€‚

è€Œä¸”ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ¯å½“ [`<Link>`](https://nextjs.org/docs/api-reference/next/link) ç»„ä»¶å‡ºç°åœ¨æµè§ˆå™¨è§†çª—ä¸­ï¼ŒNext.js å°±ä¼šåœ¨åå°è‡ªåŠ¨ **é¢„è·å–** è¢«é“¾æ¥é¡µé¢çš„ä»£ç ã€‚å½“ç”¨æˆ·ç‚¹å‡»é“¾æ¥æ—¶ï¼Œç›®æ ‡é¡µé¢çš„ä»£ç æ—©å°±åœ¨åå°åŠ è½½å¥½äº†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé¡µé¢é—´çš„åˆ‡æ¢å¥½åƒæ˜¯ç¬é—´å®Œæˆçš„ã€‚

äº†è§£æ›´å¤šå…³äº[å¯¼èˆª](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#how-routing-and-navigation-works)çš„å†…å®¹ã€‚

### æ¨¡å¼ï¼šæ˜¾ç¤ºæ¿€æ´»é“¾æ¥

ä¸€ä¸ªå¸¸è§çš„ UI æ¨¡å¼æ˜¯å‘ç”¨æˆ·å±•ç¤ºæ¿€æ´»çš„é“¾æ¥ï¼Œæ¥å‘Šè¯‰ç”¨æˆ·ä»–ä»¬ç°åœ¨åœ¨å“ªä¸ªé¡µé¢ä¸Šã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦ä» URL ä¸­è·å–åˆ°ç”¨æˆ·å½“å‰çš„åœ°å€è·¯å¾„ã€‚Next.js æä¾›äº†ä¸€ä¸ªåå« `userPathname()` çš„é’©å­ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒè·å–åœ°å€è·¯å¾„å¹¶å®ç°è¯¥æ¨¡å¼ã€‚

å› ä¸º [`userPathname()`](https://nextjs.org/docs/app/api-reference/functions/use-pathname) æ˜¯ä¸€ä¸ªé’©å­ï¼Œä½ éœ€è¦æŠŠ `nav-links.tsx` è½¬æ¢ä¸ºä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶ã€‚åœ¨è¯¥æ–‡ä»¶é¡¶ç«¯æ·»åŠ ä¸€ä¸ª React
å£°æ˜ `use client`ï¼Œç„¶åä» `next/navigation` ä¸­å¯¼å…¥ `usePathname()`ï¼š

```tsx
'use client';
 
import {
  UserGroupIcon,
  HomeIcon,
  InboxIcon,
} from '@heroicons/react/24/outline';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
 
// ...
```

ç„¶ååœ¨ `<NavLinks />` ç»„ä»¶ä¸­æŠŠè·¯å¾„èµ‹å€¼ç»™ä¸€ä¸ªå« `pathname` çš„å˜é‡ï¼š

```tsx
export default function NavLinks() {
  const pathname = usePathname();
  // ...
}
```

ä½ å¯ä»¥ä½¿ç”¨æˆ‘ä»¬åœ¨ [CSS æ ·å¼](#ç¬¬äºŒç« -css-æ ·å¼)é‚£ä¸€ç« è®²è¿‡çš„ `clsx` åº“æ¥æ ¹æ®é“¾æ¥æ˜¯å¦æ¿€æ´»è¿™ä¸ªæ¡ä»¶åº”ç”¨ä¸åŒçš„ç±»åã€‚å½“ `link.href` è·Ÿ `pathname` åŒ¹é…çš„æ—¶å€™ï¼Œé“¾æ¥æ–‡æœ¬åº”è¯¥å˜ä¸ºè“è‰²ï¼ŒèƒŒæ™¯åº”è¯¥å˜ä¸ºæµ…è“ã€‚

è¿™æ˜¯ `nav-links.tsx` æ–‡ä»¶çš„æœ€ç»ˆä»£ç ï¼š

```tsx
'use client';
 
import {
  UserGroupIcon,
  HomeIcon,
  DocumentDuplicateIcon,
} from '@heroicons/react/24/outline';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import clsx from 'clsx';
 
// ...
 
export default function NavLinks() {
  const pathname = usePathname();
 
  return (
    <>
      {links.map((link) => {
        const LinkIcon = link.icon;
        return (
          <Link
            key={link.name}
            href={link.href}
            className={clsx(
              'flex h-[48px] grow items-center justify-center gap-2 rounded-md bg-gray-50 p-3 text-sm font-medium hover:bg-sky-100 hover:text-blue-600 md:flex-none md:justify-start md:p-2 md:px-3',
              {
                'bg-sky-100 text-blue-600': pathname === link.href,
              },
            )}
          >
            <LinkIcon className="w-6" />
            <p className="hidden md:block">{link.name}</p>
          </Link>
        );
      })}
    </>
  );
}
```

ä¿å­˜ä»£ç ï¼Œç„¶åæŸ¥çœ‹ç½‘é¡µã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°å½“å‰é¡µé¢çš„é“¾æ¥æ˜¯è“è‰²é«˜äº®ã€‚

## ç¬¬å…­ç«  è®¾ç½®æ•°æ®åº“

åœ¨ç»§ç»­å¼€å‘ä»ªè¡¨ç›˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æ•°æ®ã€‚åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ `@vercel/postgres` è®¾ç½®ä¸€ä¸ª PostgreSQL æ•°æ®åº“ã€‚å¦‚æœä½ å·²ç»å¾ˆç†Ÿæ‚‰ PostgreSQL äº†ï¼Œå¹¶ä¸”æƒ³è‡ªå·±æä¾›æ•°æ®ï¼Œé‚£ä½ å¯ä»¥è·³è¿‡è¿™ä¸€ç« èŠ‚ï¼Œå¹¶è‡ªå·±å¡«å……æ•°æ®ã€‚å¦‚æœä¸æ˜¯çš„è¯ï¼Œé‚£æˆ‘ä»¬å°±ç»§ç»­äº†ï¼

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - æŠŠé¡¹ç›®æ¨åˆ° Github ä¸Š
> - åˆ›å»ºä¸€ä¸ª Vercel è´¦å·å¹¶é“¾æ¥åˆ° Github ä»“åº“ï¼Œä»¥å®ç°å¿«é€Ÿé¢„è§ˆå’Œéƒ¨ç½²
> - åˆ›å»ºå¹¶æŠŠé¡¹ç›®é“¾æ¥åˆ°ä¸€ä¸ª PostgreSQL æ•°æ®åº“
> - ç»™æ•°æ®åº“å¡«å……æ•°æ®

### åˆ›å»ºä¸€ä¸ª Github ä»“åº“

å¦‚æœä½ è¿˜æ²¡æœ‰æŠŠé¡¹ç›®æ¨åˆ° Github ä¸Šï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥åšå§ã€‚è¿™ä¼šè®©æ•°æ®åº“çš„è®¾ç½®å’Œéƒ¨ç½²å˜å¾—ç®€å•äº›ã€‚

å¦‚æœä½ éœ€è¦å¸®åŠ©ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ª [Github æ•™ç¨‹](https://help.github.com/en/github/getting-started-with-github/create-a-repo)ã€‚

> **å¥½æ¶ˆæ¯æ˜¯**
> - ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„ Git æœåŠ¡å•†ï¼Œæ¯”å¦‚ GitLab æˆ–è€… Bitbucketã€‚
> - å¦‚æœä½ æ˜¯ Github æ–°æ‰‹ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ [Github æ¡Œé¢åº”ç”¨](https://desktop.github.com/)æ¥ç®€åŒ–å¼€å‘æµç¨‹ã€‚

### åˆ›å»ºä¸€ä¸ª Vercel è´¦æˆ·

è®¿é—® https://vercel.com/signup å¹¶åˆ›å»ºä¸€ä¸ªè´¦æˆ·ã€‚é€‰æ‹©å…è´¹è®¡åˆ’ï¼ˆ"hobby"ï¼‰ï¼Œç„¶åé€‰æ‹© **Continue with Github**ï¼Œå°†ä½ çš„ Github è´¦æˆ·é“¾æ¥åˆ° Vercelã€‚

### é“¾æ¥å¹¶éƒ¨ç½²ä½ çš„é¡¹ç›®

ä¸‹ä¸€æ­¥ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼Œä½ å¯ä»¥é€‰æ‹©å¹¶å¯¼å…¥åˆšæ‰åˆ›å»ºçš„ Github ä»“åº“ï¼š

![import-git-repo](import-git-repo.avif)

ç»™ä½ çš„é¡¹ç›®èµ·ä¸€ä¸ªåå­—ç„¶åéƒ¨ç½²ã€‚

![configure-project](configure-project.avif)

ä¹Œæ‹‰ï¼ğŸ‰ä½ çš„é¡¹ç›®å·²ç»éƒ¨ç½²äº†ï¼

> è¯‘æ³¨ï¼šå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼ŒæŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œä½ åº”è¯¥å¯ä»¥è§£å†³çš„ã€‚

![deployed-project](deployed-project.avif)

é“¾æ¥åˆ° Github ä»“åº“ä¹‹åï¼Œæ¯å½“ä½ å¾€ **`main`** åˆ†æ”¯æäº¤æ›´æ”¹æ—¶ï¼ŒVercel å°±ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ä½ çš„é¡¹ç›®ï¼Œä¸éœ€è¦é¢å¤–çš„è®¾ç½®ã€‚å¦‚æœæœ‰æ‹‰å–è¯·æ±‚ï¼Œä½ ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ª[å³æ—¶é¢„è§ˆ](https://vercel.com/docs/deployments/preview-deployments#preview-urls)ï¼Œè¿™æ ·å°±èƒ½å°½æ—©åœ°å‘ç°éƒ¨ç½²é”™è¯¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªéƒ¨ç½²çš„é¢„è§ˆå‘ç»™å›¢é˜Ÿå…¶ä»–æˆå‘˜ä»¥è·å–åé¦ˆã€‚

### åˆ›å»ºä¸€ä¸ª Postgres æ•°æ®åº“

ä¸‹ä¸€æ­¥ï¼Œè®¾ç½®æ•°æ®åº“ï¼Œç‚¹å‡» **Continue to Dashboard**ï¼Œç„¶ååœ¨é¡¹ç›®é¢æ¿ä¸­é€‰æ‹© **Storage**ã€‚é€‰æ‹© **Connect Store â†’ Create New â†’ Postgres â†’ Continue**ã€‚

![create-database](create-database.avif)

æ¥å—æ¡æ¬¾ï¼Œç»™æ•°æ®åº“èµ·ä¸ªåå­—ï¼Œç¡®ä¿æ•°æ®åº“çš„åŒºåŸŸæ˜¯ **Washington D.C (iad1)**ï¼Œè¿™æ˜¯æ¯ä¸€ä¸ªæ–° Vercel é¡¹ç›®çš„[é»˜è®¤åŒºåŸŸ](https://vercel.com/docs/functions/serverless-functions/regions#select-a-default-serverless-region)ã€‚æŠŠæ•°æ®åº“æ”¾åœ¨è·Ÿåº”ç”¨ä»£ç ç›¸åŒæˆ–è€…ä¸´è¿‘çš„åŒºåŸŸï¼Œå¯ä»¥é™ä½æ•°æ®è¯·æ±‚æ—¶çš„[å»¶è¿Ÿ](https://developer.mozilla.org/en-US/docs/Web/Performance/Understanding_latency)ã€‚

![database-region](database-region.avif)

> **éœ€è¦æ³¨æ„çš„æ˜¯**ï¼Œæ•°æ®åº“åŒºåŸŸä¸€æ—¦è®¾ç½®å°±ä¸èƒ½æ›´æ”¹äº†ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ä¸åŒçš„[åŒºåŸŸ](https://vercel.com/docs/storage/vercel-postgres/limits#supported-regions)ï¼Œå°±éœ€è¦åœ¨åˆ›å»ºæ•°æ®åº“ä¹‹å‰è®¾ç½®å¥½ã€‚

è¿æ¥å¥½åï¼Œåˆ‡æ¢åˆ° `.env.local` é¡µé¢ï¼Œç‚¹å‡» **Show secret** å’Œ **Copy Snippet**ã€‚ç¡®ä¿ä½ å¤åˆ¶ä¹‹å‰å¯†é’¥æ˜¯æ˜¾ç¤ºå‡ºæ¥çš„ã€‚

![database-dashboard](database-dashboard.avif)

å›åˆ°ä»£ç ç¼–è¾‘å™¨ï¼ŒæŠŠ `.env.example` æ–‡ä»¶é‡å‘½åä¸º `.env`ï¼Œç„¶åæŠŠåˆšæ‰æ‹·è´çš„å†…å®¹ç²˜è´´åˆ°æ–‡ä»¶ä¸­ã€‚

**æ³¨æ„**ï¼šæ‰“å¼€ `.gitignore` æ–‡ä»¶ï¼Œç¡®ä¿é‡Œé¢æœ‰ `.env`ï¼Œè¿™æ ·æ‰ä¸ä¼šæŠŠä½ æ•°æ®åº“çš„å¯†é’¥ä¸Šä¼ åˆ° Github ä¸Šã€‚

æœ€åï¼Œåœ¨ç»ˆç«¯è¿è¡Œ `npm i @vercel/postgres`ï¼Œå®‰è£… [Vercel Postgres SDK](https://vercel.com/docs/storage/vercel-postgres/sdk)ã€‚

### å¡«å……æ•°æ®åº“

ç°åœ¨æ•°æ®åº“å·²ç»åˆ›å»ºå¥½äº†ï¼Œè®©æˆ‘ä»¬å¡«å……ä¸€äº›åˆå§‹æ•°æ®å§ã€‚è¿™ä¼šè®©ä½ åœ¨å¼€å‘ä»ªè¡¨ç›˜çš„æ—¶å€™æœ‰ä¸€äº›æ•°æ®å¯ç”¨ã€‚

åœ¨é¡¹ç›®çš„ `/scripts` æ–‡ä»¶å¤¹ä¸­ï¼Œæœ‰ä¸€ä¸ªæ–‡ä»¶å« `seed.js`ã€‚è¿™ä¸ªè„šæœ¬ä¸­åŒ…å«äº†ä¸€äº›åˆ›å»ºå¹¶å¡«å……è¡¨æ ¼çš„æŒ‡ä»¤ã€‚

å¦‚æœä½ ç°åœ¨çœ‹ä¸æ‡‚è¿™äº›ä»£ç å¹²äº†ä»€ä¹ˆï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œå…¶å®è¿™ä¸ªè„šæœ¬å°±æ˜¯ç”¨ **SQL** åˆ›å»ºäº†ä¸€äº›è¡¨ï¼Œç„¶åæŠŠ `placeholder-data.js` ä¸­çš„æ•°æ®ç»™å¡«å……è¿›å»äº†ã€‚

ä¸‹ä¸€æ­¥ï¼Œåœ¨ `package.json` æ–‡ä»¶ä¸­ï¼Œå°†ä¸‹é¢çš„è¡Œæ·»åŠ è¿›å»ï¼š

```json
"scripts": {
  "build": "next build",
  "dev": "next dev",
  "start": "next start",
  "seed": "node -r dotenv/config ./scripts/seed.js"
}
```

è¿™æ˜¯ä¸€ä¸ªä¼šæ‰§è¡Œ `seed.js` æ–‡ä»¶çš„å‘½ä»¤ã€‚

ç°åœ¨ï¼Œè¿è¡Œ `npm run seed`ï¼Œä½ åº”è¯¥ä¼šåœ¨ç»ˆç«¯ä¸­çœ‹åˆ°ä¸€äº› `console.log` çš„æ‰“å°ä¿¡æ¯ï¼Œè¿™ä»£è¡¨è„šæœ¬æ­£åœ¨æ­£å¸¸è¿è¡Œã€‚

> **æ•…éšœæ’é™¤**ï¼š
> - ç¡®ä¿åœ¨æ‹·è´æ•°æ®åº“å¯†é’¥çš„æ—¶å€™ç‚¹äº†æ˜¾ç¤ºå¯†é’¥ã€‚
> - è„šæœ¬ä½¿ç”¨ `bcrypt` åŠ å¯†ç”¨æˆ·çš„å¯†ç ï¼Œå¦‚æœ `bcrypt` è·Ÿä½ çš„ç¯å¢ƒä¸å…¼å®¹ï¼Œä½ ä¹Ÿå¯ä»¥ä¿®æ”¹ä¸€ä¸‹è„šæœ¬ä½¿ç”¨ `bcryptjs`ã€‚
> - å¦‚æœä½ åœ¨å¡«å……æ•°æ®åº“æ—¶é‡åˆ°é—®é¢˜ï¼Œæƒ³é‡æ–°è¿è¡Œè„šæœ¬ï¼Œä½ å¯ä»¥åœ¨æ•°æ®åº“æŸ¥è¯¢ç•Œé¢è¿è¡Œ `DROP TABLE tablename` æ¥æŠŠæ•°æ®åº“ä¸­å·²æœ‰çš„è¡¨æ ¼åˆ é™¤ã€‚æŸ¥çœ‹[æ‰§è¡ŒæŸ¥è¯¢åŒºåŸŸ](#æ‰§è¡ŒæŸ¥è¯¢)äº†è§£ç»†èŠ‚ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œè¿™æ¡å‘½ä»¤ä¼šåˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®è¡¨ï¼Œç°åœ¨æˆ‘ä»¬æ­å»ºçš„åªæ˜¯ä¸€ä¸ªæ¡ˆä¾‹åº”ç”¨ï¼Œä½¿ç”¨çš„æ•°æ®éƒ½æ˜¯å ä½æ•°æ®ï¼Œå› æ­¤æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä½†ä½ ä¸åº”è¯¥åœ¨å®é™…ä¸Šçº¿çš„åº”ç”¨ä¸­è¿è¡Œè¿™ä¸ªå‘½ä»¤ã€‚
> - å¦‚æœä½ åœ¨å¡«å…… Vercel Postgres æ•°æ®åº“æœŸé—´é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥åœ¨ Github å¼€ä¸€ä¸ª[è®¨è®ºåŒº](https://github.com/vercel/next-learn/issues)ã€‚

### æµè§ˆæ•°æ®åº“

è®©æˆ‘ä»¬çœ‹çœ‹ç°åœ¨çš„æ•°æ®åº“é‡Œæœ‰ä»€ä¹ˆã€‚å›åˆ° Vercelï¼Œåœ¨ä¾§è¾¹å¯¼èˆªä¸­ç‚¹å‡» **Data**ã€‚

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œä½ ä¼šçœ‹åˆ°æœ‰å››ä¸ªæ–°è¡¨ï¼šusersï¼Œcustomersï¼Œinvoicesï¼Œå’Œ revenueã€‚

![database-tables](database-tables.avif)

é€ä¸ªé€‰ä¸­è¡¨æ ¼ï¼Œæ£€æŸ¥é‡Œé¢çš„è®°å½•æ˜¯ä¸æ˜¯è·Ÿ `placeholder-data.js` é‡Œçš„å ä½æ•°æ®ä¸€è‡´ã€‚

### æ‰§è¡ŒæŸ¥è¯¢

ä½ å¯ä»¥åˆ‡æ¢åˆ° Query é€‰é¡¹æ¥ä¸æ•°æ®åº“äº¤äº’ã€‚è¿™ä¸ªåŒºåŸŸæ”¯æŒæ ‡å‡†çš„ SQL å‘½ä»¤ã€‚æ¯”å¦‚è¯´ï¼Œæ‰§è¡Œ `DROP TABLE customers` ä¼šæŠŠ customers è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½åˆ é™¤â€”â€”è¿™ç‚¹è¦å°å¿ƒï¼

è®©æˆ‘ä»¬æ‰§è¡Œç¬¬ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ã€‚æŠŠä¸‹é¢çš„ SQL ä»£ç ç²˜è´´åˆ° Vercel ç•Œé¢ä¸­ï¼š

```sql
SELECT invoices.amount, customers.name
FROM invoices
JOIN customers ON invoices.customer_id = customers.id
WHERE invoices.amount = 666;
```

ç„¶åè¿è¡Œã€‚

## ç¬¬ä¸ƒç«  æŠ“å–æ•°æ®

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æ•°æ®åº“ï¼Œä¹Ÿå¡«å……äº†æ•°æ®ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨åº”ç”¨ä¸­æŠ“å–æ•°æ®çš„å‡ ç§æ–¹å¼å§ï¼ŒåŒæ—¶ä¹Ÿå¼€å‘å¥½ä»ªè¡¨ç›˜çš„é¢„è§ˆé¡µé¢ã€‚

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - å­¦ä¹ å‡ ç§æŠ“å–æ•°æ®çš„æ–¹å¼ï¼šAPIï¼ŒORMï¼ŒSQLï¼Œç­‰ç­‰
> - æœåŠ¡å™¨ç»„ä»¶æ˜¯å¦‚ä½•æ›´å®‰å…¨åœ°å¸®åŠ©æˆ‘ä»¬è·å–åç«¯èµ„æºçš„
> - ç½‘ç»œç€‘å¸ƒæ˜¯å•¥
> - å¦‚ä½•å®ç°ç”¨ JavaScript æ¨¡å¼å¹¶è¡ŒæŠ“å–æ•°æ®

### é€‰æ‹©æŠ“å–æ•°æ®çš„æ–¹å¼

#### API å±‚

API æ˜¯åº”ç”¨å’Œæ•°æ®åº“ä¹‹é—´çš„ä¸­ä»‹å±‚ã€‚ä¸‹é¢å‡ ç§æƒ…å†µä½ å¯èƒ½ä¼šéœ€è¦ç”¨ APIï¼š

- å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æä¾› API çš„ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚
- å¦‚æœä½ æ˜¯åœ¨å®¢æˆ·ç«¯æŠ“å–æ•°æ®çš„ï¼Œä½ æƒ³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€ä¸ª API å±‚æ¥é¿å…ä½ çš„æ•°æ®åº“å¯†é’¥æš´éœ²ç»™ç”¨æˆ·

åœ¨ Next.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers) æ¥åˆ›å»º API ç«¯ç‚¹ã€‚

#### æ•°æ®åº“æŸ¥è¯¢

å¦‚æœä½ æ­å»ºçš„æ˜¯ä¸€ä¸ªå…¨æ ˆåº”ç”¨ï¼Œä½ ä¼šéœ€è¦ç¼–å†™ä¸€äº›é€»è¾‘ä»£ç è·Ÿæ•°æ®åº“äº¤äº’ã€‚å¯¹äºåƒ Postgres è¿™æ ·çš„[å…³ç³»å‹æ•°æ®åº“](https://aws.amazon.com/relational-database/)ï¼Œä½ å¯ä»¥ç”¨ SQLï¼Œæˆ–è€… [ORM](https://vercel.com/docs/storage/vercel-postgres/using-an-orm#)ï¼ˆæ¯”å¦‚ [Prisma](https://www.prisma.io/)ï¼‰æ¥å®ç°è¿™ç‚¹ã€‚

ä¸‹é¢å‡ ç§æƒ…å†µä¸‹ä½ å¯èƒ½ä¼šéœ€è¦æ‰‹åŠ¨ç¼–å†™æ•°æ®åº“æŸ¥è¯¢ä»£ç ï¼š

- åˆ›å»º API ç«¯ç‚¹ï¼Œä½ éœ€è¦ç¼–å†™è·Ÿæ•°æ®åº“äº¤äº’çš„é€»è¾‘ä»£ç ã€‚
- å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ React æœåŠ¡å™¨ç»„ä»¶ï¼ˆåœ¨æœåŠ¡å™¨ä¸ŠæŠ“å–æ•°æ®ï¼‰ï¼Œä½ å¯ä»¥è·³è¿‡ API å±‚ï¼Œç›´æ¥å‘æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ•°æ®åº“å¯†é’¥æš´éœ²ç»™ç”¨æˆ·ã€‚

è®©æˆ‘ä»¬äº†è§£ä¸€äº›å…³äº React æœåŠ¡å™¨ç»„ä»¶çš„å†…å®¹ã€‚

#### ä½¿ç”¨æœåŠ¡å™¨ç»„ä»¶æŠ“å–æ•°æ®

é»˜è®¤æƒ…å†µä¸‹ï¼ŒNext.js åº”ç”¨ä½¿ç”¨çš„éƒ½æ˜¯ **React æœåŠ¡å™¨ç»„ä»¶**ã€‚ç”¨æœåŠ¡å™¨ç»„ä»¶æŠ“å–æ•°æ®æ˜¯ä¸€ç§ç›¸å¯¹è¾ƒæ–°çš„æ–¹å¼ï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¥½å¤„ï¼š

- æœåŠ¡å™¨ç»„ä»¶æ”¯æŒ promiseï¼Œè¿™æ˜¯ä¸€ç§è§£å†³åƒæŠ“å–æ•°æ®è¿™æ ·çš„å¼‚æ­¥ä»»åŠ¡çš„ç®€å•æ–¹æ¡ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ `async/await` è¿™æ ·çš„è¯­æ³•ï¼Œè€Œä¸ç”¨æ¶‰åŠ `useEffect`ï¼Œ`useState` æˆ–è€…å…¶ä»–çš„æŠ“å–æ•°æ®çš„åº“ã€‚
- æœåŠ¡å™¨ç»„ä»¶åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå› æ­¤ä½ å¯ä»¥æŠŠé‡è¦æ•°æ®çš„æŠ“å–å’Œé€»è¾‘ä¿ç•™åœ¨æœåŠ¡å™¨ç«¯ï¼ŒåªæŠŠç»“æœå‘é€ç»™ç”¨æˆ·ã€‚
- å‰é¢æåˆ°äº†ï¼Œå› ä¸ºæœåŠ¡å™¨ç»„ä»¶æ˜¯åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ï¼Œä½ å¯ä»¥ç›´æ¥æŸ¥è¯¢æ•°æ®åº“è€Œä¸ç”¨é¢å¤–ç½©ä¸€å±‚ API äº†ã€‚

#### ä½¿ç”¨ SQL

å¯¹äºæˆ‘ä»¬çš„ä»ªè¡¨ç›˜é¡¹ç›®ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ [Vercel Postgres SDK](https://vercel.com/docs/storage/vercel-postgres/sdk) å’Œ SQL æ¥ç¼–å†™æ•°æ®åº“æŸ¥è¯¢ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬è¿™ä¹ˆåšçš„å‡ ç‚¹åŸå› ï¼š

- SQL æ˜¯æŸ¥è¯¢å…³ç³»å‹æ•°æ®åº“çš„è¡Œä¸šæ ‡å‡†ï¼ˆæ¯”å¦‚ï¼ŒORM åœ¨åº•å±‚ä¹Ÿæ˜¯ç”Ÿæˆäº† SQLï¼‰ã€‚
- å¯¹äº SQL æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£å…³ç³»å‹æ•°æ®åº“çš„åŸºç¡€ï¼Œæœ‰åŠ©äºæˆ‘ä»¬ä½¿ç”¨å…¶ä»–å·¥å…·ã€‚
- SQL å¾ˆå¼ºå¤§ï¼Œå¯ä»¥å…è®¸æˆ‘ä»¬æŠ“å–å’Œæ“ä½œç‰¹å®šçš„æ•°æ®ã€‚
- Vercel Postgres SDK å¯ä»¥é˜²æ­¢ [SQL æ³¨å…¥](https://vercel.com/docs/storage/vercel-postgres/sdk#preventing-sql-injections)ã€‚

å¦‚æœä½ ä¹‹å‰æ²¡ç”¨è¿‡ SQL ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å·²ç»ç»™ä½ å†™å¥½äº†æŸ¥è¯¢è¯­å¥ã€‚

æ‰“å¼€ `/app/lib/data.ts`ï¼Œä½ ä¼šçœ‹åˆ°æˆ‘ä»¬ä» `@vercel/postgres` ä¸­å¯¼å…¥äº† [`sql`](https://vercel.com/docs/storage/vercel-postgres/sdk#sql)ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå‡½æ•°æŸ¥è¯¢æ•°æ®åº“ã€‚

```ts
import { sql } from '@vercel/postgres';
 
// ...
```

ä½ å¯ä»¥åœ¨ä»»æ„æœåŠ¡å™¨ç»„ä»¶ä¸­è°ƒç”¨ `sql`ã€‚ä½†æ˜¯ä¸ºäº†è®©ä½ åœ¨ç»„ä»¶é—´å¯¼èˆªæ›´å®¹æ˜“äº›ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ•°æ®æŸ¥è¯¢éƒ½æ”¾åœ¨äº† `data.ts` æ–‡ä»¶ä¸­ï¼Œç„¶åå¯ä»¥åœ¨å…¶ä»–ç»„ä»¶ä¸­å¯¼å…¥å®ƒä»¬ã€‚

> **æ³¨æ„**ï¼šå¦‚æœä½ åœ¨ç¬¬å…­ç« æ—¶ä½¿ç”¨äº†è‡ªå·±çš„æ•°æ®åº“ï¼Œé‚£ä¹ˆä½ éœ€è¦ä¿®æ”¹ `/app/lib/data.ts` çš„æŸ¥è¯¢è¯­å¥æ¥é€‚é…ä½ çš„æ•°æ®åº“ã€‚

### ä¸ºä»ªè¡¨ç›˜é¢„è§ˆé¡µé¢æŠ“å–æ•°æ®

ç°åœ¨ç†è§£äº†æŠ“å–æ•°æ®çš„å„ç§ä¸åŒæ–¹å¼ï¼Œè®©æˆ‘ä»¬æŠ“ç‚¹æ•°æ®å§ã€‚æ‰“å¼€ `/app/dashboard/page.tsx`ï¼Œç²˜è´´ä¸‹é¢çš„ä»£ç ï¼Œç„¶åèŠ±ç‚¹æ—¶é—´è¿‡ä¸€éï¼š

```tsx
import { Card } from '@/app/ui/dashboard/cards';
import RevenueChart from '@/app/ui/dashboard/revenue-chart';
import LatestInvoices from '@/app/ui/dashboard/latest-invoices';
import { lusitana } from '@/app/ui/fonts';
 
export default async function Page() {
  return (
    <main>
      <h1 className={`${lusitana.className} mb-4 text-xl md:text-2xl`}>
        Dashboard
      </h1>
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        {/* <Card title="Collected" value={totalPaidInvoices} type="collected" /> */}
        {/* <Card title="Pending" value={totalPendingInvoices} type="pending" /> */}
        {/* <Card title="Total Invoices" value={numberOfInvoices} type="invoices" /> */}
        {/* <Card
          title="Total Customers"
          value={numberOfCustomers}
          type="customers"
        /> */}
      </div>
      <div className="mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8">
        {/* <RevenueChart revenue={revenue}  /> */}
        {/* <LatestInvoices latestInvoices={latestInvoices} /> */}
      </div>
    </main>
  );
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼š

- `Page` æ˜¯ä¸€ä¸ª **å¼‚æ­¥** ç»„ä»¶ï¼Œå®ƒå¯ä»¥å…è®¸ä½ ä½¿ç”¨ `await` æ¥æŠ“å–æ•°æ®ã€‚
- æœ‰ä¸‰ä¸ªç»„ä»¶å¯ä»¥æ¥å—æ•°æ®ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ `<Card>`ï¼Œ`<RevenueChart>`ï¼Œå’Œ `<LatestInvoices>`ã€‚ç›®å‰å…ˆå°†å®ƒä»¬æ³¨é‡Šäº†ï¼Œé¿å…æŠ¥é”™ã€‚

### ä¸º `<RevenueChart>` æŠ“å–æ•°æ®

è¦ä¸º `<RevenueChart />` ç»„ä»¶æŠ“å–æ•°æ®ï¼Œä» `data.ts` ä¸­å¯¼å…¥ `fetchRevenue` å‡½æ•°å¹¶åœ¨ç»„ä»¶å†…è°ƒç”¨ï¼š

```tsx
import { Card } from '@/app/ui/dashboard/cards';
import RevenueChart from '@/app/ui/dashboard/revenue-chart';
import LatestInvoices from '@/app/ui/dashboard/latest-invoices';
import { lusitana } from '@/app/ui/fonts';
import { fetchRevenue } from '@/app/lib/data';
 
export default async function Page() {
  const revenue = await fetchRevenue();
  // ...
}
```

ç„¶åï¼Œç§»é™¤ `<RevenueChart />` ç»„ä»¶çš„æ³¨é‡Šï¼Œæ‰“å¼€ `/app/ui/dashboard/revenue-chart.tsx` æ–‡ä»¶å¹¶æŠŠé‡Œé¢çš„ä»£ç è§£æ³¨é‡Šã€‚æŸ¥çœ‹æœ¬åœ°ç½‘é¡µï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªä½¿ç”¨äº† `revenue` æ•°æ®çš„è¡¨æ ¼ã€‚

![recent-revenue](recent-revenue.avif)

è®©æˆ‘ä»¬ç»§ç»­è·å–æ›´å¤šæ•°æ®å§ï¼

### ä¸º `<LatestInvoices>` æŠ“å–æ•°æ®

å¯¹äº `<LatestInvoices />` ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è·å–æœ€æ–°çš„ 5 æ¡å•æ®ï¼ŒæŒ‰ç…§æ—¥æœŸæ’åºã€‚

ä½ å¯ä»¥æŠ“å–æ‰€æœ‰çš„å•æ®å¹¶ç”¨ JavaScript æ’åºã€‚å¯¹äºå°‘é‡æ•°æ®æ¥è¯´è¿™æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœä½ çš„åº”ç”¨é€æ¸å˜å¤§ï¼Œæ¯æ¬¡è¯·æ±‚è·å–çš„æ•°æ®å’Œ JavaScript è¦å¤„ç†çš„æ•°æ®å°±ä¼šæ˜¾è‘—åœ°å¢é•¿ã€‚

æˆ‘ä»¬ä¸æŠ“å–æ‰€æœ‰æ•°æ®ç„¶åå†æ’åºï¼Œç›¸åï¼Œæˆ‘ä»¬ç¼–å†™ SQL æŸ¥è¯¢è¯­å¥åªæŠ“å– 5 æ¡å•æ®ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬æåˆ°çš„æŸ¥è¯¢è¯­å¥ï¼Œå®ƒåœ¨ `data.ts` æ–‡ä»¶ä¸­ï¼š

```ts
// Fetch the last 5 invoices, sorted by date
const data = await sql<LatestInvoiceRaw>`
  SELECT invoices.amount, customers.name, customers.image_url, customers.email
  FROM invoices
  JOIN customers ON invoices.customer_id = customers.id
  ORDER BY invoices.date DESC
  LIMIT 5`;
```

åœ¨ `/app/dashboard/page.tsx` ä¸­ï¼Œå¯¼å…¥ `fetchLatestInvoices` å‡½æ•°ï¼š

```tsx
import { Card } from '@/app/ui/dashboard/cards';
import RevenueChart from '@/app/ui/dashboard/revenue-chart';
import LatestInvoices from '@/app/ui/dashboard/latest-invoices';
import { lusitana } from '@/app/ui/fonts';
import { fetchRevenue, fetchLatestInvoices } from '@/app/lib/data';
 
export default async function Page() {
  const revenue = await fetchRevenue();
  const latestInvoices = await fetchLatestInvoices();
  // ...
}
```

ç„¶åï¼ŒæŠŠ `<LatestInvoices />` ç»„ä»¶è§£æ³¨é‡Šï¼Œä½ è¿˜éœ€è¦åœ¨ `/app/ui/dashboard/latest-invoices.tsx` æ–‡ä»¶ä¸­æŠŠè·Ÿ `<LatestInvoices />` ç»„ä»¶æœ‰å…³çš„ä»£ç ä¹Ÿè§£æ³¨é‡Šã€‚

æ­¤æ—¶æŸ¥çœ‹æœ¬åœ°ç½‘é¡µï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°æ•°æ®åº“ä¸Šæœ€æ–°çš„ 5 æ¡å•æ®æ˜¾ç¤ºå‡ºæ¥äº†ã€‚å¸Œæœ›ä½ ç°åœ¨èƒ½å¼€å§‹æ„Ÿå—åˆ°ç›´æ¥æŸ¥è¯¢æ•°æ®åº“çš„ä¼˜åŠ¿äº†ï¼

![latest-invoices](latest-invoices.avif)

### ç»ƒä¹ ï¼šä¸º `<Card>` ç»„ä»¶æŠ“å–æ•°æ®

ç°åœ¨ï¼Œåˆ°ä½ æ¥ä¸º `<Card>` ç»„ä»¶æŠ“å–æ•°æ®äº†ã€‚å¡ç‰‡ä¼šå±•ç¤ºå¦‚ä¸‹æ•°æ®ï¼š

- å•æ®çš„æ€»é‡‘é¢
- å¾…åŠå•æ®çš„æ€»é‡‘é¢
- å•æ®çš„æ€»æ•°é‡
- ç”¨æˆ·çš„æ€»æ•°é‡

è¿™é‡Œï¼Œä½ å¯èƒ½è¿˜æ˜¯ä¼šæƒ³å…ˆæŠ“å–æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åç”¨ JavaScript å–å¤„ç†ã€‚æ¯”å¦‚è¯´ç”¨ `Array.length` æ¥è·å–å•æ®å’Œç”¨æˆ·çš„æ€»æ•°ã€‚

```js
const totalInvoices = allInvoices.length;
const totalCustomers = allCustomers.length;
```

ä½†æ˜¯æœ‰äº† SQLï¼Œä½ å¯ä»¥åªæŠ“å–ä½ éœ€è¦çš„æ•°æ®ã€‚ä¸‹é¢çš„ä»£ç æ¯”ä¸Šé¢çš„ç¨å¾®é•¿äº†é‚£ä¹ˆä¸€ç‚¹ï¼Œä½†æ˜¯å®ƒè½¬ç§»çš„æ•°æ®æ¯”ä¸Šé¢çš„è¦å°‘å¾ˆå¤šï¼š

```js
const invoiceCountPromise = sql`SELECT COUNT(*) FROM invoices`;
const customerCountPromise = sql`SELECT COUNT(*) FROM customers`;
```

è¿™æ¬¡ä½ è¦å¯¼å…¥çš„å‡½æ•°å« `fetchCardDate`ï¼Œä½ éœ€è¦æŠŠè¿™ä¸ªå‡½æ•°è¿”å›çš„å€¼è§£æ„ã€‚

> **æç¤º**ï¼š
> - æŸ¥çœ‹å¡ç‰‡ç»„ä»¶éƒ½éœ€è¦å“ªäº›æ•°æ®ã€‚
- æŸ¥çœ‹ `data.ts` æ–‡ä»¶ï¼Œçœ‹çœ‹å‡½æ•°è¿”å›äº†ä»€ä¹ˆã€‚

å½“ä½ å®Œæˆåï¼Œä½ å¯ä»¥å±•å¼€å¦‚ä¸‹ä»£ç æŸ¥çœ‹æœ€ç»ˆçš„ä»£ç ï¼š

> è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼ˆå½“ç„¶æ— æ³•æŠ˜å å•¦~ï¼‰

```tsx
import { Card } from '@/app/ui/dashboard/cards';
import RevenueChart from '@/app/ui/dashboard/revenue-chart';
import LatestInvoices from '@/app/ui/dashboard/latest-invoices';
import { lusitana } from '@/app/ui/fonts';
import {
  fetchRevenue,
  fetchLatestInvoices,
  fetchCardData,
} from '@/app/lib/data';
 
export default async function Page() {
  const revenue = await fetchRevenue();
  const latestInvoices = await fetchLatestInvoices();
  const {
    numberOfInvoices,
    numberOfCustomers,
    totalPaidInvoices,
    totalPendingInvoices,
  } = await fetchCardData();
 
  return (
    <main>
      <h1 className={`${lusitana.className} mb-4 text-xl md:text-2xl`}>
        Dashboard
      </h1>
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <Card title="Collected" value={totalPaidInvoices} type="collected" />
        <Card title="Pending" value={totalPendingInvoices} type="pending" />
        <Card title="Total Invoices" value={numberOfInvoices} type="invoices" />
        <Card
          title="Total Customers"
          value={numberOfCustomers}
          type="customers"
        />
      </div>
      <div className="mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8">
        <RevenueChart revenue={revenue} />
        <LatestInvoices latestInvoices={latestInvoices} />
      </div>
    </main>
  );
}
```
{: file="/app/dashboard/page.tsx"}

å¾ˆå¥½ï¼ä½ ç°åœ¨å·²ç»æŠŠæ‰€æœ‰é¢„è§ˆé¡µéœ€è¦çš„æ•°æ®éƒ½æŠ“å–åˆ°äº†ï¼Œä½ çš„é¡µé¢åº”è¯¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![complete-dashboard](complete-dashboard.avif)

ç„¶è€Œï¼Œè¿™é‡Œæœ‰ä¸¤ä»¶äº‹æƒ…ä½ éœ€è¦æ³¨æ„ï¼š

1. æ•°æ®è¯·æ±‚æ— æ„ä¸­ç›¸äº’é˜»å¡äº†ï¼Œé€ æˆäº† **è¯·æ±‚ç€‘å¸ƒ**ã€‚
2. é»˜è®¤æƒ…å†µä¸‹ï¼ŒNext.js ä¼š **é¢„æ¸²æŸ“** é¡µé¢ä»¥æé«˜æ€§èƒ½ï¼Œè¿™è¢«å«åš **é™æ€æ¸²æŸ“**ã€‚å¦‚æœä½ çš„æ•°æ®æ›´æ”¹äº†ï¼Œä»ªè¡¨ç›˜ä¸Šä¸ä¼šæœ‰ç›¸åº”çš„æ›´æ”¹ã€‚

### ä»€ä¹ˆæ˜¯è¯·æ±‚ç€‘å¸ƒï¼Ÿ

â€œç€‘å¸ƒâ€æŒ‡çš„æ˜¯æœ‰ä¸€ç³»åˆ—çš„ç½‘ç»œè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½åªèƒ½åœ¨ä¹‹å‰çš„è¯·æ±‚ç»“æŸåæ‰èƒ½å¼€å§‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œåªæœ‰ä¸Šä¸€ä¸ªè¯·æ±‚è¿”å›æ•°æ®äº†ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚æ‰å¼€å§‹ã€‚

![sequential-parallel-data-fetching](sequential-parallel-data-fetching.avif)

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬éœ€è¦ç­‰ `fetchRevenue()` ç»“æŸäº†æ‰èƒ½å¼€å§‹æ‰§è¡Œ `fetchLatestInvoices()`ï¼Œä»¥æ­¤ç±»æ¨ã€‚

```tsx
const revenue = await fetchRevenue();
const latestInvoices = await fetchLatestInvoices(); // wait for fetchRevenue() to finish
const {
  numberOfInvoices,
  numberOfCustomers,
  totalPaidInvoices,
  totalPendingInvoices,
} = await fetchCardData(); // wait for fetchLatestInvoices() to finish
```

è¿™ç§æ¨¡å¼å€’ä¸æ˜¯è¯´ä¸å¯¹ã€‚æœ‰äº›æƒ…å†µä¸‹ä½ çš„ç¡®éœ€è¦è¿™äº›ç€‘å¸ƒï¼Œä½ å¸Œæœ›ç­‰ä¸€ä¸ªè¯·æ±‚å®Œå…¨ç»“æŸåå†è¿›è¡Œä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œä¾‹å¦‚ä½ å¯èƒ½éœ€è¦å…ˆæŠ“å–ç”¨æˆ·çš„ ID å’Œç®€ä»‹ï¼Œå†æŠ“å–ä»–ä»¬çš„å¥½å‹åˆ—è¡¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåä¸€ä¸ªè¯·æ±‚ä¾èµ–äºå‰ä¸€ä¸ªè¯·æ±‚è¿”å›çš„æ•°æ®ã€‚

ç„¶è€Œï¼Œè¿™ç§ç°è±¡æœ‰æ—¶å€™ä¹Ÿå¯èƒ½æ˜¯æ— æ„çš„ï¼Œå¹¶ä¸”ä¼šå½±å“æ€§èƒ½ã€‚

### å¹¶è¡ŒæŠ“å–æ•°æ®

ä¸€ä¸ªé¿å…è¯·æ±‚ç€‘å¸ƒçš„å¸¸è§æ–¹æ³•å°±æ˜¯åŒä¸€æ—¶é—´åˆå§‹åŒ–æ‰€æœ‰æ•°æ®è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å¹¶è¡Œåœ°è¯·æ±‚ã€‚

åœ¨ JavaScript ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ [`Promise.all()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all) æˆ–è€… [`Promise.allSettled()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled) å‡½æ•°æ¥åŒæ—¶åˆå§‹åŒ–æ‰€æœ‰çš„ promisesã€‚æ¯”å¦‚è¯´ï¼Œåœ¨ `data.ts` ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `fetchCardData()` å‡½æ•°ä¸­ä½¿ç”¨ `Promise.all()`ï¼š

```ts
export async function fetchCardData() {
  try {
    const invoiceCountPromise = sql`SELECT COUNT(*) FROM invoices`;
    const customerCountPromise = sql`SELECT COUNT(*) FROM customers`;
    const invoiceStatusPromise = sql`SELECT
         SUM(CASE WHEN status = 'paid' THEN amount ELSE 0 END) AS "paid",
         SUM(CASE WHEN status = 'pending' THEN amount ELSE 0 END) AS "pending"
         FROM invoices`;
 
    const data = await Promise.all([
      invoiceCountPromise,
      customerCountPromise,
      invoiceStatusPromise,
    ]);
    // ...
  }
}
```

é€šè¿‡è¿™ç§æ¨¡å¼ï¼Œä½ å¯ä»¥ï¼š

- åŒæ—¶æ‰§è¡Œæ‰€æœ‰çš„æ•°æ®æŠ“å–ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚
- ä½¿ç”¨ JavaScript åŸç”Ÿçš„æ¨¡å¼ï¼Œå¯ä»¥åº”ç”¨åˆ°ä»»æ„ç¬¬ä¸‰æ–¹åº“æˆ–è€…æ¡†æ¶ã€‚

ä½†æ˜¯ï¼Œä½¿ç”¨è¿™ç§ JavaScript æ¨¡å¼æœ‰ä¸€ä¸ª **é—®é¢˜**ï¼šå¦‚æœå…¶ä¸­ä¸€ä¸ªæ•°æ®è¯·æ±‚æ¯”å…¶ä»–å‡ ä¸ªæ…¢æ€ä¹ˆåŠï¼Ÿ

## ç¬¬å…«ç«  é™æ€å’ŒåŠ¨æ€æ¸²æŸ“

åœ¨ä¸Šä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬ä¸ºä»ªè¡¨ç›˜çš„é¢„è§ˆé¡µé¢æŠ“å–äº†æ•°æ®ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿç®€å•è®¨è®ºäº†ä¸€ä¸‹äº§ç”Ÿçš„ä¸¤ä¸ªå±€é™ï¼š

1. è¿™äº›æ•°æ®è¯·æ±‚æ— æ„ä¸­é€ æˆäº†ç½‘ç»œç€‘å¸ƒã€‚
2. ä»ªè¡¨ç›˜æ˜¯é™æ€çš„ï¼Œå› æ­¤æœ‰æ•°æ®æ›´æ–°æ—¶ä¸ä¼šå‘ˆç°åœ¨åº”ç”¨ä¸Šã€‚

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - é™æ€æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆå®ƒèƒ½æå‡åº”ç”¨çš„æ€§èƒ½
> - åŠ¨æ€æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™ç”¨
> - è®©ä»ªè¡¨ç›˜å˜æˆåŠ¨æ€çš„å‡ ç§æ–¹æ³•
> - æ¨¡æ‹Ÿä¸€ä¸ªå¾ˆæ…¢çš„æ•°æ®è¯·æ±‚æ¥çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ

### ä»€ä¹ˆæ˜¯é™æ€æ¸²æŸ“ï¼Ÿ

é™æ€æ¸²æŸ“ï¼Œæ˜¯æŒ‡æ•°æ®æŠ“å–å’Œæ¸²æŸ“å‘ç”Ÿåœ¨æœåŠ¡å™¨éƒ¨ç½²é˜¶æ®µï¼Œæˆ–è€…é‡æ–°éªŒè¯é˜¶æ®µã€‚è¯·æ±‚å’Œæ¸²æŸ“çš„ç»“æœå¯ä»¥ç¼“å­˜åœ¨[å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰](https://nextjs.org/docs/app/building-your-application/rendering/server-components#static-rendering-default)å¹¶ç¨ååˆ†å‘ã€‚

![static-site-generation-2](static-site-generation.avif)

å½“ç”¨æˆ·è®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼Œç¼“å­˜çš„æ•°æ®å°±ä¼šè¢«å‘é€ã€‚é™æ€æ¸²æŸ“æœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š

- **æ›´å¿«çš„ç½‘ç«™**ï¼šé¢„æ¸²æŸ“çš„å†…å®¹å¯ä»¥è¢«ç¼“å­˜å¹¶ä¸”å¤§èŒƒå›´å‘æ”¾ã€‚è¿™ç¡®ä¿ä¸–ç•Œå„åœ°çš„ç”¨æˆ·å¯ä»¥æ›´å¿«æ›´ç¨³å®šåœ°è®¿é—®ç½‘ç«™çš„å†…å®¹ã€‚
- **é™ä½æœåŠ¡å™¨è´Ÿè½½**ï¼šå› ä¸ºå†…å®¹å·²ç»ç¼“å­˜äº†ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·è¯·æ±‚åŠ¨æ€ç”Ÿæˆæ•°æ®ã€‚
- **SEO**ï¼šé¢„æ¸²æŸ“çš„å†…å®¹æ›´ä¾¿äºæœç´¢å¼•æ“çˆ¬è™«å»ºç«‹ç´¢å¼•ã€‚å› ä¸ºåœ¨é¡µé¢åŠ è½½æ—¶å†…å®¹å°±å·²ç»å­˜åœ¨äº†ã€‚è¿™å¯ä»¥æé«˜å†…å®¹åœ¨æœç´¢å¼•æ“ä¸­çš„æ’åã€‚

é™æ€æ¸²æŸ“å¯¹äº**ä¸éœ€è¦æ•°æ®**çš„ UI æˆ–è€… **åœ¨æ‰€æœ‰ç”¨æˆ·é—´å…±äº«æ•°æ®** çš„ UI æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæ¯”å¦‚ä¸€ç¯‡é™æ€çš„åšå®¢ï¼Œæˆ–è€…ä¸€ä¸ªäº§å“é¡µã€‚ä½†å¯¹äºä¸€ä¸ªç»å¸¸æ›´æ–°ç”¨æˆ·æ•°æ®çš„ä»ªè¡¨ç›˜æ¥è¯´ï¼Œè¿™å°±ä¸å¤ªåˆé€‚äº†ã€‚

ä¸é™æ€æ¸²æŸ“ç›¸å¯¹çš„å°±æ˜¯åŠ¨æ€æ¸²æŸ“ã€‚

### ä»€ä¹ˆæ˜¯åŠ¨æ€æ¸²æŸ“ï¼Ÿ

åŠ¨æ€æ¸²æŸ“æŒ‡çš„æ˜¯å†…å®¹åœ¨æ¯æ¬¡ç”¨æˆ· **å‘é€è¯·æ±‚**ï¼ˆè®¿é—®ç½‘é¡µï¼‰çš„æ—¶å€™ï¼Œç”±æœåŠ¡å™¨é‡æ–°æ¸²æŸ“ã€‚åŠ¨æ€æ¸²æŸ“æœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š

- **å®æ—¶æ•°æ®**ï¼šåŠ¨æ€æ¸²æŸ“å…è®¸åº”ç”¨å±•ç¤ºå®æ—¶æˆ–è€…ç»å¸¸æ›´æ–°çš„æ•°æ®ã€‚
- **ç‰¹å®šç”¨æˆ·çš„å†…å®¹**ï¼šå±•ç¤ºå„ä¸ªç”¨æˆ·è‡ªå·±çš„æ•°æ®å°±å¾ˆå®¹æ˜“äº†ï¼Œæ¯”å¦‚ä»ªè¡¨ç›˜æˆ–è€…ç”¨æˆ·ç®€ä»‹ï¼Œç„¶åæ ¹æ®ç”¨æˆ·è¡Œä¸ºæ›´æ–°æ•°æ®ã€‚
- **è¯·æ±‚æ—¶ä¿¡æ¯**ï¼šåŠ¨æ€æ¸²æŸ“å…è®¸ä½ è·å–åªæœ‰åœ¨è¯·æ±‚æ—¶æ‰èƒ½çŸ¥é“çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ cookiesï¼Œæˆ–è€… URL æœç´¢å‚æ•°ã€‚

### æŠŠä»ªè¡¨ç›˜å˜æˆåŠ¨æ€çš„

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`@vercel/postgres` è‡ªå·±æ²¡æœ‰ç¼“å­˜åŠŸèƒ½ã€‚è¿™å°±æ˜¯è¯´æ¡†æ¶éœ€è¦è®¾å®šå®ƒè‡ªå·±çš„é™æ€æˆ–è€…åŠ¨æ€è¡Œä¸ºã€‚

ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç»„ä»¶æˆ–è€…æ•°æ®æŠ“å–å‡½æ•°ä¸­ä½¿ç”¨ä¸€ä¸ªå« `unstable_noStore` çš„ Next.js API æ¥å–æ¶ˆé™æ€æ¸²æŸ“ã€‚æˆ‘ä»¬æ¥è¯•è¯•ï¼š

åœ¨ `data.ts` æ–‡ä»¶ä¸­ï¼Œä» `next/cache` ä¸­å¯¼å…¥ `unstable_noStore`ï¼Œç„¶ååœ¨æ•°æ®æŠ“å–å‡½æ•°ä¸­å…ˆè°ƒç”¨å®ƒï¼š

```ts
// ...
import { unstable_noStore as noStore } from 'next/cache';
 
export async function fetchRevenue() {
  // Add noStore() here to prevent the response from being cached.
  // This is equivalent to in fetch(..., {cache: 'no-store'}).
  noStore();
 
  // ...
}
 
export async function fetchLatestInvoices() {
  noStore();
  // ...
}
 
export async function fetchCardData() {
  noStore();
  // ...
}
 
export async function fetchFilteredInvoices(
  query: string,
  currentPage: number,
) {
  noStore();
  // ...
}
 
export async function fetchInvoicesPages(query: string) {
  noStore();
  // ...
}
 
export async function fetchFilteredCustomers(query: string) {
  noStore();
  // ...
}
 
export async function fetchInvoiceById(query: string) {
  noStore();
  // ...
}
```

> **æ³¨æ„**ï¼š`unstable_noStore` æ˜¯ä¸€ä¸ªè¯•éªŒ APIï¼Œå¯èƒ½å°†æ¥ä¼šæ”¹å˜ï¼Œå¦‚æœä½ æƒ³åœ¨é¡¹ç›®ä¸­ç”¨ä¸€ä¸ªæ›´ç¨³å®šçš„ APIï¼Œå¯ä»¥è¯•è¯•[è·¯ç”±æ®µé…ç½®é€‰é¡¹](https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config) `export const dynamic = "force-dynamic"`ã€‚

### æ¨¡æ‹Ÿä¸€ä¸ªå¾ˆæ…¢çš„æ•°æ®æŠ“å–

æŠŠä»ªè¡¨ç›˜å˜ä¸ºåŠ¨æ€æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¸Šä¸€ç« èŠ‚æåˆ°çš„é—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚å¦‚æœä¸€ä¸ªæ•°æ®è¯·æ±‚æ¯”å…¶ä»–çš„æ…¢æ€ä¹ˆåŠï¼Ÿ

è®©æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªå¾ˆæ…¢çš„æ•°æ®è¯·æ±‚ã€‚åœ¨ `data.ts` æ–‡ä»¶ä¸­ï¼ŒæŠŠ `fetchRevenue()` ä¸­çš„ `console.log` å’Œ `setTimeout` è§£æ³¨é‡Šã€‚

```ts
export async function fetchRevenue() {
  try {
    // We artificially delay a response for demo purposes.
    // Don't do this in production :)
    console.log('Fetching revenue data...');
    await new Promise((resolve) => setTimeout(resolve, 3000));
 
    const data = await sql<Revenue>`SELECT * FROM revenue`;
 
    console.log('Data fetch completed after 3 seconds.');
 
    return data.rows;
  } catch (error) {
    console.error('Database Error:', error);
    throw new Error('Failed to fetch revenue data.');
  }
}
```

ç°åœ¨åœ¨ä¸€ä¸ªæ–°æ ‡ç­¾é¡µè®¿é—® http://localhost:3000/dashboard/ ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°é¡µé¢èŠ±äº†å¾ˆé•¿æ—¶é—´åŠ è½½ã€‚åœ¨ç»ˆç«¯ä¸­ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š

```text
Fetching revenue data...
Data fetch completed after 3 seconds.
```

è¿™é‡Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª 3 ç§’çš„å»¶è¿Ÿæ¥æ¨¡æ‹Ÿä¸€ä¸ªå¾ˆæ…¢çš„æ•°æ®è¯·æ±‚ã€‚ç»“æœæ˜¯åœ¨æ•°æ®æŠ“å–çš„æ—¶å€™ä½ æ•´ä¸ªé¡µé¢éƒ½å¡ä½äº†ã€‚

è¿™å°±æ˜¯å¼€å‘è€…è¦è§£å†³çš„ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼š

ä½¿ç”¨åŠ¨æ€æ¸²æŸ“çš„æ—¶å€™ï¼Œ**ä½ çš„åº”ç”¨çš„å“åº”é€Ÿåº¦æ˜¯è·Ÿä½ é‚£ä¸ªæœ€æ…¢çš„æ•°æ®è¯·æ±‚é€Ÿåº¦ä¸€æ ·çš„**ã€‚

## ç¬¬ä¹ç«  æµ

åœ¨ä¸Šä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬æŠŠä»ªè¡¨ç›˜æ”¹æˆåŠ¨æ€æ¸²æŸ“äº†ï¼Œæˆ‘ä»¬ä¹Ÿè®¨è®ºäº†å¾ˆæ…¢çš„æ•°æ®æŠ“å–æ˜¯å¦‚ä½•å½±å“ç½‘é¡µçš„æ€§èƒ½çš„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹åœ¨æ•°æ®è¯·æ±‚å¾ˆæ…¢çš„æƒ…å†µä¸‹æ€ä¹ˆä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - æµæ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™ç”¨
> - æ€ä¹ˆç”¨ `loading.tsx` å’Œ Suspense å®ç°æµ
> - åŠ è½½éª¨æ¶æ˜¯ä»€ä¹ˆ
> - è·¯ç”±ç»„æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™ç”¨
> - è¦æŠŠç½‘é¡µçš„å“ªäº›éƒ¨åˆ†ç”¨ Suspense åŒ…èµ·æ¥

### ä»€ä¹ˆæ˜¯æµï¼Ÿ

æµæ˜¯ä¸€ç§æ•°æ®ä¼ è¾“æŠ€æœ¯ï¼Œå®ƒå¯ä»¥æŠŠä¸€ä¸ªé¡µé¢åˆ†æˆå‡ ä¸ªå°â€œå—â€ï¼Œç„¶åä»æœåŠ¡ç«¯ä¸€ç‚¹ç‚¹æŠŠè¿™äº›å—å‘é€åˆ°ï¼ˆæµåˆ°ï¼‰ç”¨æˆ·ç«¯ã€‚

![server-rendering-with-streaming](server-rendering-with-streaming.avif)

æœ‰äº†æµï¼Œæˆ‘ä»¬å°±å¯ä»¥é˜²æ­¢ä¸€äº›å¾ˆæ…¢çš„æ•°æ®æŠ“å–é˜»å¡ä½æˆ‘ä»¬çš„æ•´ä¸ªé¡µé¢ã€‚è¿™å°±å¯ä»¥è®©ç”¨æˆ·å…ˆçœ‹åˆ°é¡µé¢çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸ç”¨ç­‰ç€æ‰€æœ‰çš„æ•°æ®éƒ½åŠ è½½å®Œæ‰èƒ½çœ‹åˆ°é¡µé¢ã€‚

![server-rendering-with-streaming-chart](server-rendering-with-streaming-chart.avif)

React çš„ç»„ä»¶æ¨¡å‹å¯ä»¥å¾ˆå¥½åœ°è·ŸæµæŠ€æœ¯é€‚é…ï¼Œå› ä¸ºæ¯ä¸€ä¸ªç»„ä»¶éƒ½å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ª *å—*ã€‚

åœ¨ Next.js ä¸­å®ç°æµæœ‰ä¸¤ç§æ–¹å¼ï¼š

1. åœ¨é¡µé¢å±‚é¢ä½¿ç”¨ `loading.tsx` æ–‡ä»¶ã€‚
2. å¯¹äºç‰¹å®šçš„ç»„ä»¶ï¼Œä½¿ç”¨ `<Suspense>`ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¯¥æ€ä¹ˆåšã€‚

### ç”¨ `loading.tsx` æµå¼åŠ è½½æ•´ä¸ªé¡µé¢

åœ¨ `/app/dashboard` æ–‡ä»¶å¤¹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º `loading.tsx` çš„æ–°æ–‡ä»¶ï¼š

```tsx
export default function Loading() {
  return <div>Loading...</div>;
}
```

åˆ·æ–° http://localhost:3000/dashboard ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ï¼š

![loading-page](loading-page.avif)

è¿™é‡Œå‘ç”Ÿäº†å¦‚ä¸‹å‡ ä»¶äº‹ï¼š

1. `loading.tsx` æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨ Suspense ä¹‹ä¸Šçš„ç‰¹æ®Šçš„ Next.js æ–‡ä»¶ã€‚å®ƒå…è®¸ä½ åœ¨æ•°æ®è¿˜åœ¨åŠ è½½æ—¶åˆ›å»ºä¸€ä¸ªå¤‡ç”¨ UI ç•Œé¢å±•ç¤ºç»™ç”¨æˆ·ã€‚
2. å› ä¸º `<Sidebar>` æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥å®ƒç«‹åˆ»å°±æ˜¾ç¤ºå‡ºæ¥äº†ã€‚åœ¨æ•°æ®è¿˜åœ¨åŠ è½½æ—¶ï¼Œç”¨æˆ·ä¾ç„¶å¯ä»¥ç‚¹å‡»ä¾§è¾¹æ ã€‚
3. ç”¨æˆ·ä¸éœ€è¦ç­‰å¾…é¡µé¢å…¨éƒ¨åŠ è½½å®Œæ¯•ä¹‹åæ‰èƒ½è·³è½¬èµ°ï¼ˆè¿™å«å¯ä¸­æ–­è·³è½¬ï¼‰ã€‚

æ­å–œä½ ï¼Œä½ åˆšåˆšå®ç°äº†æµï¼ä½†æ˜¯æˆ‘ä»¬éœ€è¦å†åšäº›ä»€ä¹ˆæ¥æå‡ç”¨æˆ·ä½“éªŒã€‚è®©æˆ‘ä»¬æŠŠ `Loading...` è¿™æ®µæ–‡æœ¬æ›¿æ¢ä¸ºåŠ è½½éª¨æ¶ã€‚

#### æ·»åŠ åŠ è½½éª¨æ¶

åŠ è½½éª¨æ¶æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬çš„ UI ç•Œé¢ã€‚å¾ˆå¤šç½‘ç«™éƒ½ç”¨å®ƒæ¥ä½œä¸ºå ä½ UIï¼ˆå¤‡ç”¨ UIï¼‰æ¥æç¤ºç”¨æˆ·å†…å®¹è¿˜åœ¨åŠ è½½ä¸­ã€‚ä½ åœ¨ `loading.tsx` ä¸­åµŒå…¥çš„ä»»ä½• UI éƒ½ä¼šæˆä¸ºé™æ€æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å…ˆè¢«å‘é€ã€‚ç„¶åï¼Œå…¶ä»–çš„åŠ¨æ€æ•°æ®ä¼šä¸€ç‚¹ç‚¹ä»æœåŠ¡ç«¯æµå‘ç”¨æˆ·ç«¯ã€‚

åœ¨ `loading.tsx` æ–‡ä»¶ä¸­ï¼Œå¯¼å…¥ä¸€ä¸ªå« `<DashboardSkeleton>` çš„æ–°ç»„ä»¶ï¼š

```tsx
import DashboardSkeleton from '@/app/ui/skeletons';
 
export default function Loading() {
  return <DashboardSkeleton />;
}
```

ç„¶ååˆ·æ–° http://localhost:3000/dashboard ä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š

![loading-page-with-skeleton](loading-page-with-skeleton.avif)

#### è§£å†³è·¯ç”±ç»„åŠ è½½éª¨æ¶çš„ bug

ç°åœ¨ï¼Œè¿™ä¸ªåŠ è½½éª¨æ¶ä¹Ÿä¼šåº”ç”¨åˆ°å•æ®é¡µé¢å’Œç”¨æˆ·é¡µé¢ã€‚å› ä¸º `loading.tsx` æ˜¯ä¸€ä¸ªæ¯” `/invoices/page.tsx` å’Œ `/customers/page.tsx` æ›´é«˜å±‚çš„æ–‡ä»¶ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨[è·¯ç”±ç»„](https://nextjs.org/docs/app/building-your-application/routing/route-groups)ä¿®æ­£è¿™ä¸€ç‚¹ã€‚åœ¨ `dashboard` æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º `/(overview)` çš„æ–‡ä»¶å¤¹ï¼Œç„¶åæŠŠ `loading.tsx` å’Œ `page.tsx` æ”¾è¿›å»ï¼š

![route-group](route-group.avif)

ç°åœ¨ `loading.tsx` å°±åªä¼šå‡ºç°åœ¨ä»ªè¡¨ç›˜çš„é¢„è§ˆé¡µé¢äº†ã€‚

è·¯ç”±ç»„å…è®¸ä½ æŠŠä¸€äº›æ–‡ä»¶ç»„ç»‡è¿›ä¸€äº›é€»è¾‘ä¸Šçš„ç»„ï¼Œè€Œä¸ä¼šå½±å“ URL è·¯å¾„ç»“æ„ã€‚å½“ä½ ç”¨åœ†æ‹¬å· `()` åˆ›å»ºæ–‡ä»¶å¤¹æ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹çš„åå­—ä¸ä¼šå‡ºç°åœ¨ URL è·¯å¾„ä¸­ï¼Œæ‰€ä»¥ `/dashboard/(overview)/page.tsx` å®é™…å°±æ˜¯ `/dashboard`ã€‚

è¿™é‡Œæˆ‘ä»¬ç”¨è·¯ç”±ç»„æ¥ç¡®ä¿ `loading.tsx` åªåº”ç”¨åˆ°ä»ªè¡¨ç›˜é¢„è§ˆé¡µé¢ã€‚ç„¶è€Œï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è·¯ç”±ç»„æŠŠåº”ç”¨åˆ†æˆä¸åŒçš„éƒ¨åˆ†ï¼Œæ¯”å¦‚ `(marketing)` å’Œ `(shop)` ç­‰ã€‚

#### æµå¼ä¼ è¾“ä¸€ä¸ªç»„ä»¶

ç›®å‰ï¼Œæˆ‘ä»¬æ˜¯åœ¨æ•´ä¸ªé¡µé¢ä¸Šåº”ç”¨æµå¼ä¼ è¾“çš„ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æœ‰ç»†ç²’åº¦æ›´é«˜åœ°æ§åˆ¶ï¼Œä½¿ç”¨ React Suspense æµå¼ä¼ è¾“ç‰¹å®šçš„ç»„ä»¶ã€‚

Suspense å…è®¸ä½ å¯ä»¥æ¨è¿Ÿæ¸²æŸ“éƒ¨åˆ†åº”ç”¨é¡µé¢ï¼Œç›´åˆ°æŸäº›æ¡ä»¶ç¬¦åˆæ—¶æ‰æ¸²æŸ“ï¼ˆæ¯”å¦‚æ•°æ®åŠ è½½ä¹‹åï¼‰ã€‚ä½ å¯ä»¥æŠŠè¦åŠ¨æ€æ¸²æŸ“çš„ç»„ä»¶ç”¨ Suspense åŒ…èµ·æ¥ã€‚ç„¶åï¼ŒæŠŠä¸€ä¸ªå¤‡ç”¨ç»„ä»¶ä¼ é€’è¿‡å»ï¼Œä½œä¸ºåŠ¨æ€ç»„ä»¶åŠ è½½æ—¶å±•ç¤ºç»™ç”¨æˆ·çš„å†…å®¹ã€‚

å¦‚æœä½ è¿˜è®°å¾— `fetchRevenue()`ï¼Œå®ƒæ˜¯é‚£ä¸ªæŠŠæ•´ä¸ªé¡µé¢éƒ½æ‹–å®çš„æ…¢é€Ÿæ•°æ®è¯·æ±‚ã€‚ä¸ºäº†ä¸é˜»å¡æ•´ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥åªæŠŠè¿™ä¸ªç»„ä»¶ç”¨ Suspense è®¾ç½®ä¸ºæµå¼ä¼ è¾“ï¼Œè€Œå…¶ä»–çš„é¡µé¢ UI éƒ½æ˜¯ç«‹å³å‘ˆç°ã€‚

è¦å®ç°è¿™ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®æŠ“å–å‡½æ•°æ”¾åˆ°ç»„ä»¶ä¸­ã€‚è®©æˆ‘ä»¬æ¥æ›´æ–°ä¸€ä¸‹ä»£ç ï¼š

åœ¨ `/dashboard/(overview)/page.tsx` ä¸­ï¼ŒæŠŠ `fetchRevenue()` çš„æ‰€æœ‰å®ä¾‹éƒ½åˆ é™¤

```tsx
import { Card } from '@/app/ui/dashboard/cards';
import RevenueChart from '@/app/ui/dashboard/revenue-chart';
import LatestInvoices from '@/app/ui/dashboard/latest-invoices';
import { lusitana } from '@/app/ui/fonts';
import { fetchLatestInvoices, fetchCardData } from '@/app/lib/data'; // remove fetchRevenue
 
export default async function Page() {
  const revenue = await fetchRevenue // delete this line
  const latestInvoices = await fetchLatestInvoices();
  const {
    numberOfInvoices,
    numberOfCustomers,
    totalPaidInvoices,
    totalPendingInvoices,
  } = await fetchCardData();
 
  return (
    // ...
  );
}
```

ç„¶åï¼Œä» React å¯¼å…¥ `<Suspense>`ï¼Œç”¨å®ƒæŠŠ `<RevenueChart />` åŒ…èµ·æ¥ã€‚ä½ å¯ä»¥æŠŠå¤‡ç”¨ç»„ä»¶ `<RevenueChartSkeleton>` ä¼ é€’è¿‡å»ã€‚

```tsx
import { Card } from '@/app/ui/dashboard/cards';
import RevenueChart from '@/app/ui/dashboard/revenue-chart';
import LatestInvoices from '@/app/ui/dashboard/latest-invoices';
import { lusitana } from '@/app/ui/fonts';
import { fetchLatestInvoices, fetchCardData } from '@/app/lib/data';
import { Suspense } from 'react';
import { RevenueChartSkeleton } from '@/app/ui/skeletons';
 
export default async function Page() {
  const latestInvoices = await fetchLatestInvoices();
  const {
    numberOfInvoices,
    numberOfCustomers,
    totalPaidInvoices,
    totalPendingInvoices,
  } = await fetchCardData();
 
  return (
    <main>
      <h1 className={`${lusitana.className} mb-4 text-xl md:text-2xl`}>
        Dashboard
      </h1>
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <Card title="Collected" value={totalPaidInvoices} type="collected" />
        <Card title="Pending" value={totalPendingInvoices} type="pending" />
        <Card title="Total Invoices" value={numberOfInvoices} type="invoices" />
        <Card
          title="Total Customers"
          value={numberOfCustomers}
          type="customers"
        />
      </div>
      <div className="mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8">
        <Suspense fallback={<RevenueChartSkeleton />}>
          <RevenueChart />
        </Suspense>
        <LatestInvoices latestInvoices={latestInvoices} />
      </div>
    </main>
  );
}
```

æœ€åï¼Œåœ¨ `/app/ui/dashboard/revenue-chart.tsx` æ–‡ä»¶ä¸­æ›´æ–° `<RevenueChart>` ç»„ä»¶ï¼Œè®©å®ƒè‡ªå·±æŠ“å–æ•°æ®ï¼Œè€Œä¸ç”¨å‚æ•°ä¼ é€’äº†ï¼š

```tsx
import { generateYAxis } from '@/app/lib/utils';
import { CalendarIcon } from '@heroicons/react/24/outline';
import { lusitana } from '@/app/ui/fonts';
import { fetchRevenue } from '@/app/lib/data';
 
// ...
 
export default async function RevenueChart() { // Make component async, remove the props
  const revenue = await fetchRevenue(); // Fetch data inside the component
 
  const chartHeight = 350;
  const { yAxisLabels, topLabel } = generateYAxis(revenue);
 
  if (!revenue || revenue.length === 0) {
    return <p className="mt-4 text-gray-400">No data available.</p>;
  }
 
  return (
    // ...
  );
}
```

ç°åœ¨ï¼Œåˆ·æ–°é¡µé¢ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä»ªè¡¨ç›˜çš„å…¶ä»–ä¿¡æ¯éƒ½ç«‹åˆ»æ˜¾ç¤ºäº†ï¼Œåªæœ‰ `<RevenueChart>` å±•ç¤ºäº†ä¸€ä¸ªå¤‡ç”¨ç»„ä»¶éª¨æ¶ã€‚

![loading-revenue-chart](loading-revenue-chart.avif)

#### ç»ƒä¹ ï¼šæµå¼ä¼ è¾“ `<LatestInvoices>`

ç°åœ¨åˆ°ä½ äº†ï¼ç»ƒä¹ ä¸€ä¸‹åˆšæ‰å­¦åˆ°çš„å†…å®¹ï¼ŒæŠŠ `<LatestInvoices>` ç»„ä»¶æ”¹ä¸ºæµå¼ä¼ è¾“ã€‚

æŠŠ `fetchLatestInvoices()` ç§»åŠ¨åˆ° `<LatestInvoices>` ç»„ä»¶ä¸­ï¼Œç”¨ `<Suspense>` æŠŠç»„ä»¶åŒ…èµ·æ¥ï¼Œç„¶åä¼ é€’ä¸€ä¸ªå« `<LatestInvoicesSkeleton>` çš„å¤‡ç”¨ç»„ä»¶ã€‚

å½“ä½ åšå®Œåï¼Œå±•å¼€ä¸‹é¢çš„ä»£ç æŸ¥çœ‹è§£å†³æ–¹æ¡ˆï¼š

> è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼ˆå½“ç„¶æ— æ³•æŠ˜å å•¦~ï¼‰

```tsx
import { Card } from '@/app/ui/dashboard/cards';
import RevenueChart from '@/app/ui/dashboard/revenue-chart';
import LatestInvoices from '@/app/ui/dashboard/latest-invoices';
import { lusitana } from '@/app/ui/fonts';
import { fetchCardData } from '@/app/lib/data'; // Remove fetchLatestInvoices
import { Suspense } from 'react';
import {
  RevenueChartSkeleton,
  LatestInvoicesSkeleton,
} from '@/app/ui/skeletons';
 
export default async function Page() {
  // Remove `const latestInvoices = await fetchLatestInvoices()`
  const {
    numberOfInvoices,
    numberOfCustomers,
    totalPaidInvoices,
    totalPendingInvoices,
  } = await fetchCardData();
 
  return (
    <main>
      <h1 className={`${lusitana.className} mb-4 text-xl md:text-2xl`}>
        Dashboard
      </h1>
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <Card title="Collected" value={totalPaidInvoices} type="collected" />
        <Card title="Pending" value={totalPendingInvoices} type="pending" />
        <Card title="Total Invoices" value={numberOfInvoices} type="invoices" />
        <Card
          title="Total Customers"
          value={numberOfCustomers}
          type="customers"
        />
      </div>
      <div className="mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8">
        <Suspense fallback={<RevenueChartSkeleton />}>
          <RevenueChart />
        </Suspense>
        <Suspense fallback={<LatestInvoicesSkeleton />}>
          <LatestInvoices />
        </Suspense>
      </div>
    </main>
  );
}
```
{: file="/app/dashboard/(overview)/page.tsx"}

`<LatestInvoices>` ç»„ä»¶è®°å¾—åˆ é™¤å‚æ•°ï¼

```tsx
import { ArrowPathIcon } from '@heroicons/react/24/outline';
import clsx from 'clsx';
import Image from 'next/image';
import { lusitana } from '@/app/ui/fonts';
import { fetchLatestInvoices } from '@/app/lib/data';
 
export default async function LatestInvoices() { // Remove props
  const latestInvoices = await fetchLatestInvoices();
 
  return (
    // ...
  );
}
```
{: file="/app/ui/dashboard/latest-invoices.tsx"}

### ç»„ä»¶ç¼–ç»„

å¾ˆå¥½ï¼Œä½ å·²ç»åšæŒåˆ°è¿™å„¿äº†ï¼ç°åœ¨ä½ éœ€è¦æŠŠ `<Card>` ç»„ä»¶ä¹Ÿç”¨ Suspense åŒ…èµ·æ¥ã€‚ä½ å¯ä»¥ä¸ºæ¯ä¸€ä¸ªå¡ç‰‡å•ç‹¬æŠ“å–æ•°æ®ï¼Œä½†æ˜¯è¿™æ ·ä¼šè®©å¡ç‰‡æœ‰ä¸€ç§ä¸€ä¸ªä¸ª *å¼¹å‡º* çš„æ•ˆæœï¼Œå¯èƒ½ä¼šè®©ç”¨æˆ·çœ‹ä¸Šå»ä¸èˆ’æœã€‚

æ‰€ä»¥ï¼Œä½ æ‰“ç®—æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

è¦åˆ›å»ºä¸€ç§æ›´ *äº¤é”™* çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªåŒ…è£…ç»„ä»¶æŠŠå¡ç‰‡åŒ…èµ·æ¥ã€‚è¿™å°±æ˜¯è¯´ï¼Œé™æ€çš„ `<Sidebar />` å…ˆå‡ºç°ï¼Œç„¶åå¡ç‰‡å‡ºç°ï¼š

åœ¨ `/app/dashboard/page.tsx` æ–‡ä»¶ä¸­ï¼Œ

1. åˆ é™¤ `<Card>` ç»„ä»¶ã€‚
2. åˆ é™¤ `fetchCardData()` å‡½æ•°ã€‚
3. å¯¼å…¥ä¸€ä¸ªæ–°çš„ **åŒ…è£…** ç»„ä»¶ `<CardWrapper />`ã€‚
4. åˆ°ä¸€ä¸ªæ–°çš„ **éª¨æ¶** ç»„ä»¶ `<CardSkeleton />`ã€‚
5. ç”¨ Suspense æŠŠ `<CardWrapper />` åŒ…èµ·æ¥ã€‚

```tsx
import CardWrapper from '@/app/ui/dashboard/cards';
// ...
import {
  RevenueChartSkeleton,
  LatestInvoicesSkeleton,
  CardsSkeleton,
} from '@/app/ui/skeletons';
 
export default async function Page() {
  return (
    <main>
      <h1 className={`${lusitana.className} mb-4 text-xl md:text-2xl`}>
        Dashboard
      </h1>
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <Suspense fallback={<CardsSkeleton />}>
          <CardWrapper />
        </Suspense>
      </div>
      // ...
    </main>
  );
}
```

ç„¶åæ‰“å¼€ `/app/ui/dashboard/cards.tsx`ï¼Œå¯¼å…¥ `fetchCardData()` å‡½æ•°ï¼Œåœ¨ `<CardWrapper />` ç»„ä»¶ä¸­è°ƒç”¨ã€‚ç¡®ä¿ä½ æŠŠè¿™ä¸ªç»„ä»¶ä¸­çš„å¿…éœ€ä»£ç éƒ½è§£æ³¨é‡Šäº†ã€‚

```tsx
// ...
import { fetchCardData } from '@/app/lib/data';
 
// ...
 
export default async function CardWrapper() {
  const {
    numberOfInvoices,
    numberOfCustomers,
    totalPaidInvoices,
    totalPendingInvoices,
  } = await fetchCardData();
 
  return (
    <>
      <Card title="Collected" value={totalPaidInvoices} type="collected" />
      <Card title="Pending" value={totalPendingInvoices} type="pending" />
      <Card title="Total Invoices" value={numberOfInvoices} type="invoices" />
      <Card
        title="Total Customers"
        value={numberOfCustomers}
        type="customers"
      />
    </>
  );
}
```

åˆ·æ–°é¡µé¢ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°æ‰€æœ‰çš„å¡ç‰‡éƒ½åœ¨åŒæ—¶åŠ è½½è¿›æ¥ã€‚å½“ä½ æƒ³è®©å¤šä¸ªç»„ä»¶åŒæ—¶åŠ è½½çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚

### å†³å®šåœ¨å“ªé‡Œæ”¾ç½® Suspense

åœ¨å“ªé‡Œæ”¾ç½® Suspense å–å†³äºå‡ ä»¶äº‹ï¼š

1. é¡µé¢æµå¼ä¼ è¾“æ—¶ï¼Œä½ æƒ³è®©ç”¨æˆ·çœ‹åˆ°ä»€ä¹ˆã€‚
2. å“ªäº›å†…å®¹è¦ä¼˜å…ˆã€‚
3. ç»„ä»¶æ˜¯å¦ä¾èµ–äºæ•°æ®æŠ“å–ã€‚

çœ‹ä¸€çœ‹ä½ çš„ä»ªè¡¨ç›˜é¡µé¢ï¼Œæœ‰å“ªäº›åœ°æ–¹ä½ æƒ³æ”¹ä¸€æ”¹çš„å—ï¼Ÿ

ä¸ç”¨æ‹…å¿ƒï¼Œè¿™ä¸ªæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆã€‚

- ä½ å¯ä»¥æŠŠ **æ•´ä¸ªé¡µé¢** éƒ½ç”¨æµå¼ä¼ è¾“ï¼Œå°±åƒæˆ‘ä»¬ç”¨ `loading.tsx` é‚£æ ·ï¼Œä¸è¿‡å¦‚æœæŸä¸ªæ•°æ®æŠ“å–å¾ˆæ…¢ï¼Œé‚£å°±ä¼šè®©æ•´ä¸ªé¡µé¢çš„åŠ è½½æ—¶é—´å˜é•¿ã€‚
- ä½ å¯ä»¥å¯¹ **æ¯ä¸ªç»„ä»¶** å•ç‹¬ç”¨æµå¼ä¼ è¾“ï¼Œä½†è¿™ä¼šè®© UI ç»„ä»¶ *å¼¹å°„* åˆ°å±å¹•ä¸Šã€‚
- ä½ å¯ä»¥é€šè¿‡æµå¼ä¼ è¾“ä¸åŒçš„ **é¡µé¢åŒºåŸŸ** æ¥åˆ›å»º *äº¤é”™* æ•ˆæœï¼Œä½†æ˜¯è¿™éœ€è¦ä½ åˆ›å»ºåŒ…è£…ç»„ä»¶ã€‚

åœ¨å“ªé‡Œæ”¾ç½® Suspense ä¼šæ ¹æ®åº”ç”¨çš„ä¸åŒè€Œä¸åŒã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šæŠŠæ•°æ®æŠ“å–æ”¾åˆ°éœ€è¦å®ƒçš„ç»„ä»¶ä¸­ï¼Œç„¶åæŠŠç»„ä»¶ç”¨ Suspense åŒ…èµ·æ¥ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³æŒ‰ç…§é¡µé¢åŒºåŸŸæµå¼ä¼ è¾“ï¼Œæˆ–è€…ç›´æ¥æµå¼ä¼ è¾“æ•´ä¸ªé¡µé¢ï¼Œè¿™ä¹Ÿæ²¡ä»€ä¹ˆé”™ï¼Œåªè¦ä½ çš„åº”ç”¨éœ€è¦ã€‚

å¤§èƒ†å»ä½¿ç”¨ Suspense å§ï¼Œçœ‹çœ‹å“ªä¸ªæ–¹æ¡ˆæ•ˆæœæ›´å¥½ã€‚è¿™æ˜¯ä¸ªååˆ†å¼ºå¤§çš„ APIï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºæ›´æ„‰æ‚¦çš„ç”¨æˆ·ä½“éªŒã€‚

### å‰ç»

æµå¼ä¼ è¾“å’ŒæœåŠ¡å™¨ç»„ä»¶ä¸ºæˆ‘ä»¬çš„æ•°æ®æŠ“å–å’ŒåŠ è½½çŠ¶æ€æä¾›äº†æ–°çš„æ–¹å¼ï¼Œå¹¶æœ€ç»ˆä»¥æå‡ç”¨æˆ·ä½“éªŒä¸ºç›®æ ‡ã€‚

åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬ä¼šå­¦ä¹ å±€éƒ¨é¢„æ¸²æŸ“ï¼Œä¸€ç§ä¾æ‰˜äºæµå¼ä¼ è¾“å»ºç«‹çš„æ–°çš„ Next.js æ¸²æŸ“æ¨¡å‹ã€‚

## ç¬¬åç«  å±€éƒ¨é¢„æ¸²æŸ“ï¼ˆå¯é€‰ï¼‰

> å±€éƒ¨é¢„æ¸²æŸ“æ˜¯ä¸€ä¸ª Next.js 14 å¼•å…¥çš„è¯•éªŒåŠŸèƒ½ã€‚éšç€è¿™é¡¹åŠŸèƒ½é€æ¸è¶‹äºç¨³å®šï¼Œæœ¬é¡µé¢çš„å†…å®¹å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦‚æœä½ ä¸æƒ³ä½¿ç”¨è¯•éªŒåŠŸèƒ½ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€ç« èŠ‚ã€‚è¯¥ç« èŠ‚ä¸æ˜¯å­¦ä¹ æœ¬æ•™ç¨‹çš„å¿…éœ€ç« èŠ‚ã€‚

> **æœ¬ç« æˆ‘ä»¬ä¼šè®²åˆ°â€¦â€¦**
> - å±€éƒ¨é¢„æ¸²æŸ“æ˜¯ä»€ä¹ˆ
> - å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„

### å°†é™æ€å’ŒåŠ¨æ€å†…å®¹ç»“åˆèµ·æ¥

ç°åœ¨ï¼Œå¦‚æœä½ åœ¨é¡µé¢ä¸­è°ƒç”¨ä¸€ä¸ª[åŠ¨æ€å‡½æ•°](https://nextjs.org/docs/app/building-your-application/routing/route-handlers#dynamic-functions)ï¼ˆæ¯”å¦‚ `noStore()` æˆ–è€… `cookies()` ç­‰ï¼‰ï¼Œä½ çš„æ•´ä¸ªé¡µé¢éƒ½ä¼šå˜æˆåŠ¨æ€çš„ã€‚

è¿™å…¶å®è·Ÿç°åœ¨å¤§å¤šæ•°ç½‘ç«™çš„æ„å»ºæ–¹å¼ä¸€è‡´ï¼Œåœ¨ä½ ä¸º **æ•´ä¸ªç½‘ç«™** æˆ–è€… **ç‰¹å®šé¡µé¢** é€‰æ‹©æ¸²æŸ“æ–¹å¼æ—¶ï¼Œä½ åªèƒ½é€‰æ‹©è¦ä¹ˆæ˜¯é™æ€çš„ï¼Œè¦ä¹ˆæ˜¯åŠ¨æ€çš„ã€‚

ä½†æ˜¯ï¼Œå¤§å¤šæ•°é¡µé¢å¹¶ä¸æ˜¯å…¨é™æ€æˆ–è€…å…¨åŠ¨æ€ã€‚ä½ çš„é¡µé¢å¯èƒ½æ—¢æœ‰é™æ€å†…å®¹ä¹Ÿæœ‰åŠ¨æ€å†…å®¹ã€‚æ¯”å¦‚è¯´ï¼Œä½ æœ‰ä¸€ä¸ªç¤¾äº¤åª’ä½“å¹³å°ï¼Œä¸Šé¢çš„è´´å­æ˜¯é™æ€çš„ï¼Œä½†è´´å­çš„ç‚¹èµæ•°æ˜¯åŠ¨æ€çš„ã€‚æˆ–è€…ä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ï¼Œä¸Šé¢çš„äº§å“ç»†èŠ‚æ˜¯é™æ€çš„ï¼Œä½†ç”¨æˆ·çš„è´­ç‰©è½¦æ˜¯åŠ¨æ€çš„ã€‚

å›åˆ°æˆ‘ä»¬çš„ä»ªè¡¨ç›˜é¡µé¢ï¼Œå“ªäº›ç»„ä»¶ä½ è®¤ä¸ºæ˜¯é™æ€çš„ï¼Œå“ªäº›åˆæ˜¯åŠ¨æ€çš„ï¼Ÿ

å½“ä½ æƒ³å¥½åï¼Œå¯ä»¥å±•å¼€ä¸‹é¢çš„å†…å®¹ï¼Œçœ‹çœ‹æˆ‘ä»¬æ€ä¹ˆåˆ’åˆ†ä»ªè¡¨ç›˜é¡µé¢ã€‚

> è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼ˆå½“ç„¶æ— æ³•æŠ˜å å•¦~ï¼‰

![dashboard-static-dynamic-components](dashboard-static-dynamic-components.avif)

- `<SideNav>` ç»„ä»¶æ—¢ä¸ä¾èµ–äºæ•°æ®ï¼Œä¹Ÿä¸æ˜¯ç‰¹å®šäºæŸä¸ªç”¨æˆ·çš„ï¼Œå› æ­¤æ˜¯ **é™æ€** çš„ã€‚
- `<Page>` ä¸­çš„ç»„ä»¶ä¾èµ–äºæ•°æ®ï¼Œä¼šç»å¸¸å˜åŒ–ï¼Œè€Œä¸”æœ‰ç‰¹å®šäºç”¨æˆ·çš„å†…å®¹ï¼Œå› æ­¤æ˜¯ **åŠ¨æ€** çš„ã€‚

### å±€éƒ¨é¢„æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ Next.js 14 ä¸­ï¼Œæœ‰ä¸€ä¸ªæ–°çš„é¢„è§ˆç‰ˆæ¸²æŸ“æ¨¡å‹ï¼Œå« **å±€éƒ¨é¢„æ¸²æŸ“**ã€‚å®ƒæ˜¯ä¸€ä¸ªè¯•éªŒåŠŸèƒ½ï¼Œå…è®¸ä½ åœ¨æ¸²æŸ“é¡µé¢æ—¶ä½¿ç”¨ä¸€ä¸ªé™æ€çš„åŠ è½½å¤–å£³ï¼ŒåŒæ—¶ä¿æŒæŸäº›éƒ¨åˆ†æ˜¯åŠ¨æ€çš„ã€‚æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥æŠŠé¡µé¢çš„åŠ¨æ€éƒ¨åˆ†éš”ç¦»å‡ºæ¥ã€‚

![thinking-in-ppr](thinking-in-ppr.avif)

å½“ç”¨æˆ·è®¿é—®é¡µé¢æ—¶ï¼š

- ä¸€ä¸ªé™æ€çš„é¡µé¢ *å¤–å£³* å…ˆæ¸²æŸ“ï¼Œè¿™ä¼šåŠ å¿«åˆæ¬¡åŠ è½½çš„é€Ÿåº¦ã€‚
- è¿™ä¸ªå¤–å£³ä¼šç•™ä¸‹ä¸€äº› *æ´*ï¼Œç»™é‚£äº›åŠ¨æ€å†…å®¹å¼‚æ­¥åŠ è½½ã€‚
- è¿™äº›å¼‚æ­¥çš„å†…å®¹æ˜¯å¹¶è¡ŒåŠ è½½çš„ï¼Œå‡å°‘äº†æ•´ä¸ªé¡µé¢çš„åŠ è½½æ—¶é—´ã€‚

è¿™è·Ÿå’±ä»¬ç¼–å†™çš„åº”ç”¨ä¸åŒï¼Œå’±ä»¬çš„é¡µé¢è¦ä¹ˆæ˜¯å…¨é™æ€çš„ï¼Œè¦ä¹ˆæ˜¯å…¨åŠ¨æ€çš„ã€‚

å±€éƒ¨é¢„æ¸²æŸ“æŠŠæå¿«çš„é™æ€å†…å®¹åˆ†å‘å’Œå…¨éƒ¨çš„åŠ¨æ€åŠŸèƒ½ç»“åˆåœ¨äº†ä¸€èµ·ã€‚æˆ‘ä»¬ç›¸ä¿¡å®ƒæœ‰[æˆä¸ºç½‘é¡µåº”ç”¨é»˜è®¤æ¸²æŸ“æ¨¡å‹](https://vercel.com/blog/partial-prerendering-with-next-js-creating-a-new-default-rendering-model)çš„æ½œåŠ›ï¼ŒåŒæ—¶å¸¦æ¥æœ€å¥½çš„é™æ€ç½‘ç«™ç”Ÿæˆå’ŒåŠ¨æ€å†…å®¹åˆ†å‘ã€‚

### å±€éƒ¨é¢„æ¸²æŸ“æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ

å±€éƒ¨é¢„æ¸²æŸ“åˆ©ç”¨äº† React çš„å¹¶å‘ APIï¼Œä½¿ç”¨ Suspense æ¥å»¶è¿Ÿéƒ¨åˆ†é¡µé¢çš„æ¸²æŸ“ï¼Œç›´åˆ°å®ƒä»¬ç¬¦åˆæŸç§æ¡ä»¶ï¼ˆæ¯”å¦‚æ•°æ®åŠ è½½å®Œäº†ï¼‰ã€‚

å¤‡ç”¨ UI æ˜¯è·Ÿå…¶ä»–é™æ€å†…å®¹ä¸€èµ·å¾…åœ¨åˆå§‹åŒ–çš„é™æ€æ–‡ä»¶ä¸­ã€‚åœ¨æ„å»ºé˜¶æ®µï¼ˆæˆ–è€…é‡æ–°éªŒè¯é˜¶æ®µï¼‰ï¼Œé¡µé¢çš„é™æ€å†…å®¹ä¼š *é¢„æ¸²æŸ“*ï¼Œç„¶åå‰©ä¸‹çš„ä¼šå»¶åï¼Œç›´åˆ°ç”¨æˆ·è®¿é—®è¿™äº›é¡µé¢æ‰æ¸²æŸ“ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒæŠŠä¸€ä¸ªç»„ä»¶åŒ…è¿› Suspense ä¸­å¹¶ä¸ä¼šæŠŠè¿™ä¸ªç»„ä»¶å˜æˆåŠ¨æ€çš„ï¼ˆè¿˜è®°å¾—ä½ æ˜¯é€šè¿‡ `unstable_noStore` æ¥å®ç°è¿™ç‚¹çš„ï¼‰ï¼ŒSuspense åªæ˜¯é¡µé¢ä¸­é™æ€å’ŒåŠ¨æ€å†…å®¹çš„ä¸€ä¸ªåˆ†ç•Œçº¿ã€‚

å…³äºå±€éƒ¨é¢„æ¸²æŸ“å¾ˆå¥½çš„ä¸€æ–¹é¢æ˜¯ï¼Œä½¿ç”¨å®ƒæ—¶ä½ ä¸éœ€è¦é¢å¤–ä¿®æ”¹ä»£ç ã€‚åªè¦ä½ æ˜¯ç”¨ Suspense åœ¨é¡µé¢ä¸­åŒ…è£¹åŠ¨æ€å†…å®¹çš„ï¼ŒNext.js å°±ä¼šçŸ¥é“ä½ é¡µé¢çš„å“ªéƒ¨åˆ†å†…å®¹æ˜¯é™æ€çš„ï¼Œå“ªéƒ¨åˆ†æ˜¯åŠ¨æ€çš„ã€‚

> **æç¤º**ï¼šè¦å­¦ä¹ æ›´å¤šå…³äºå¦‚ä½•é…ç½®å±€éƒ¨é¢„æ¸²æŸ“ï¼Œä½ å¯ä»¥æŸ¥çœ‹[å±€éƒ¨é¢„æ¸²æŸ“æ–‡æ¡£](https://nextjs.org/docs/app/api-reference/next-config-js/partial-prerendering)ï¼Œæˆ–è€…å°è¯•[å±€éƒ¨é¢„æ¸²æŸ“æ¨¡æ¿å’Œæ¼”ç¤º](https://vercel.com/templates/next.js/partial-prerendering-nextjs)ã€‚è¯·ç‰¢è®°ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯ **è¯•éªŒæ€§** çš„ï¼Œè¿˜ **ä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ä¸­**ã€‚

### æ€»ç»“

å›é¡¾ä¸€ä¸‹ï¼Œåœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åšäº†å¦‚ä¸‹å‡ ä»¶äº‹æ¥ä¼˜åŒ–æ•°æ®æŠ“å–ï¼š

1. æŠŠæ•°æ®åº“åˆ›å»ºåœ¨è·Ÿåº”ç”¨ä»£ç åŒä¸€åŒºåŸŸï¼Œä»¥é™ä½æœåŠ¡å™¨å’Œæ•°æ®åº“ä¹‹é—´çš„å»¶è¿Ÿã€‚
2. ç”¨ React æœåŠ¡å™¨ç»„ä»¶åœ¨æœåŠ¡å™¨ä¸ŠæŠ“å–æ•°æ®ã€‚è¿™å¯ä»¥è®©ä½ æŠŠé‡è¦çš„æ•°æ®æŠ“å–å’Œé€»è¾‘ä¿ç•™åœ¨æœåŠ¡å™¨ç«¯ï¼Œå‡å°‘ç”¨æˆ·ç«¯çš„ JavaScript æ†ç»‘åŒ…ï¼ŒåŒæ—¶é˜²æ­¢æ•°æ®åº“å¯†é’¥æš´éœ²ç»™ç”¨æˆ·ã€‚
3. ä½¿ç”¨ SQL åªæŠ“å–ä½ éœ€è¦çš„æ•°æ®ï¼Œå‡å°‘æ¯æ¬¡è¯·æ±‚æ—¶çš„æ•°æ®ä¼ è¾“é‡ï¼Œä¹Ÿå‡å°‘ JavaScript éœ€è¦åœ¨å†…å­˜ä¸­å¤„ç†çš„æ•°æ®é‡ã€‚
4. ç”¨ JavaScript å¹¶è¡ŒæŠ“å–æ•°æ®â€”â€”åœ¨éœ€è¦æ—¶è¿™ä¹ˆåšã€‚
5. å®ç°æµå¼ä¼ è¾“ä»¥é˜²æ­¢æ…¢é€Ÿçš„æ•°æ®æŠ“å–é˜»å¡ä½æ•´ä¸ªé¡µé¢ï¼Œä¹Ÿè®©ç”¨æˆ·å¯ä»¥åœ¨æ•°æ®åŠ è½½å®Œä¹‹å‰å°±èƒ½ä¸ç•Œé¢ UI äº¤äº’ã€‚
6. æŠŠæ•°æ®æŠ“å–å‡½æ•°ç§»åŠ¨åˆ°éœ€è¦å®ƒä»¬çš„ç»„ä»¶ä¸­ï¼Œè¿™æ ·å¯ä»¥æŠŠé¡µé¢ä¸­éœ€è¦åŠ¨æ€å†…å®¹çš„éƒ¨åˆ†éš”ç¦»å¼€ï¼Œä»¥ä¾¿ä½¿ç”¨å±€éƒ¨é¢„æ¸²æŸ“ã€‚

ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ ä¸¤ç§ä½ åœ¨æŠ“å–æ•°æ®æ—¶å¯èƒ½ä¼šéœ€è¦çš„æ¨¡å¼ï¼šæœç´¢å’Œåˆ†é¡µã€‚

## ç¬¬åä¸€ç«  æ·»åŠ æœç´¢å’Œåˆ†é¡µ 

## ç¬¬åå…­ç«  æ·»åŠ å…ƒæ•°æ®
